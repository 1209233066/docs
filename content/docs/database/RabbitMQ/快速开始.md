---
date: '2025-07-28T10:57:00+08:00'
draft: false
title: '快速开始'
linkTitle: '快速开始'
type: blog
toc_hide: false
hide_summary: true
weight: 1
description: >

tags: ["安装rabbitmq"]
categories: ["rabbitmq"]
url: rabbitmq/install.html
author: "wangendao"
---





{{% alert title="内容概要" color="" %}}

  + 什么是rabbitMQ
  + 安装单机版本rabbitMQ
  + python 编写demo


{{% /alert %}}

---


RabbitMQ 是一个开源的消息中间件（Message Broker），实现了 AMQP（Advanced Message Queuing Protocol） 协议，同时也支持 STOMP、MQTT 等协议。它用于在分布式系统中异步传递消息，解决系统间解耦、削峰、异步处理等问题。



 **RabbitMQ 的核心概念**

| 概念                         | 说明                                               | 类比               |
| ---------------------------- | -------------------------------------------------- | ------------------ |
| `Producer`      | 生产者发送消息到 RabbitMQ 的应用程序。                   | 寄快递的人         |
| `Consumer`    | 消费者从队列中接收并处理消息的程序。                     | 收快递的人         |
| `Queue`         | 存储消息的缓冲区，消息在这里等待被消费。           | 快递柜             |
| [`Exchange`](#exchange_type)       | 接收生产者消息，根据规则路由到一个或多个队列。     | 快递分拣中心       |
| `Routing Key`    | 生产者发送消息时指定的“地址”，用于匹配绑定的规则。 | 快递上的地址       |
| `Binding`          | 定义 Exchange 和 Queue 之间的关系，包含路由规则。  | 快递分拣规则       |
| `Channel`       | 轻量级连接，复用 TCP 连接，减少资源消耗。          | 快递员的送货路线   |
| `Virtual Host` | 逻辑隔离的命名空间，类似数据库的 schema。          | 不同快递公司的仓库 |

---

<span id="exchange_type" />


常见 Exchange 类型

| 类型        | 描述                                            | 场景                                |
| ----------- | ----------------------------------------------- | ----------------------------------- |
| `Direct`  | 精确匹配 routing key。                          | 日志级别分发（error、info、warn）。 |
| `Fanout`  | 广播消息到所有绑定队列，忽略 routing key。      | 群发通知。                          |
| `Topic`   | 模糊匹配 routing key（支持通配符 `*` 和 `#`）。 | 多维度日志分类。                    |
| `Headers` | 基于消息头（headers）匹配，少用。               | 复杂规则匹配。                      |

---


### 单机部署

| 软件     | 版本           | 端口                                                         |
| -------- | -------------- | ------------------------------------------------------------ |
| erlang   | 26.2           |                                                              |
| rabbitMQ | 3.12.10、4.1.3 | 提供给客户端连接 `5672`   浏览器管理`15672`  集群内部通讯 `25672` |

**第一步：安装erlang依赖**

> erlang 环境可以将其理解为运行java程序时的jre 环境

```bash
yum install make gcc gcc-c++ perl ncurses-devel
```

```bash
git clone https://github.com/erlang/otp.git && cd otp/
git checkout maint-26
git reset --hard OTP-26.2
```

```bash
./configure --prefix /opt/erlang
make -j 8 
make install 
```

```bash
# 26.2 是erlang软件的版本，这里看到的14.2是erlang内部运行时系统的版本
[root@seagullcore01-uat-s2 rabbitmq_server-3.12.10]# /opt/erlang/bin/erl -version
Erlang (SMP,ASYNC_THREADS) (BEAM) emulator version 14.2
```

```bash
export PATH=/opt/erlang/bin:$PATH
```

**第二步：安装rabbitMQ**

```bash
wget https://mirrors.huaweicloud.com/rabbitmq-server/v3.12.10/rabbitmq-server-generic-unix-3.12.10.tar.xz

tar xf rabbitmq-server-generic-unix-3.12.10.tar.xz -C /opt
ln -svf /opt/rabbitmq_server-3.12.10 /opt/rabbitmq
```

启动

{{% alert title="管理插件" color="" %}}

3.12.10版本没有自带管理页面，因此需要提前启用该plugins 

```bash
/opt/rabbitmq/sbin/rabbitmq-plugins enable rabbitmq_management
```

{{% /alert %}}

```bash
# 启动rabbitMQ
# 日志文件：/opt/rabbitmq/var/log/rabbitmq/rabbit@seagullcore01-uat-s2.log
# 数据文件：/opt/rabbitmq/var/lib/rabbitmq/mnesia/rabbit@seagullcore01-uat-s2
/opt/rabbitmq/sbin/rabbitmq-server -detached
# 查看rabbtiMQ状态 
/opt/rabbitmq/sbin/rabbitmqctl status
# 停止rabbitMQ
# /opt/rabbitmq/sbin/rabbitmqctl shutdown
```

创建管理员用户`admin`

```bash
# /opt/rabbitmq//sbin/rabbitmqctl delete_user admin
 
/opt/rabbitmq//sbin/rabbitmqctl add_user admin
 /opt/rabbitmq//sbin/rabbitmqctl change_password admin admin
/opt/rabbitmq//sbin/rabbitmqctl set_user_tags admin administrator
# 授予 / vhost的所有权限，给admin 用户
/opt/rabbitmq/sbin/rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"
/opt/rabbitmq/sbin/rabbitmqctl set_permissions -p test admin ".*" ".*" ".*"

]# /opt/rabbitmq/sbin/rabbitmqctl list_users
Listing users ...
user    tags
admin   [administrator]
guest   [administrator]

]# /opt/rabbitmq/sbin/rabbitmqctl list_permissions -p /
Listing permissions for vhost "/" ...
user    configure       write   read
guest   .*      .*      .*
admin   .*      .*      .*
```


---

### 配置rabbitmq

通过上面启动示例，rabbitmq 启动时并没有指定配置文件。如果我们希望做一些定制化的参数修改可以在`/opt/rabbitmq/etc/rabbitmq/` 目录中创建 `rabbitmq.config`配置文件



> 查看运行时配置: `/opt/rabbitmq/sbin/rabbitmq-diagnostics environment`


+ 修改端口和内存限制

  ```bash
  cat >/opt/rabbitmq/etc/rabbitmq/rabbitmq.conf <<'EOF'
  # 网络配置
  listeners.tcp.default = 0.0.0.0:5672
  # 资源限制
  ## 允许使用总内存的40%
  #vm_memory_high_watermark.relative = 0.4
  ## 允许使用1G内存
  vm_memory_high_watermark.absolute = 1073741824
  EOF
  ```

+ 修改数据文件和日志文件路径

  ```bash
  mkdir -p /data/rabbitmq/{mnesia,logs}
  #chown -R rabbitmq:rabbitmq /data/rabbitmq
  
  cat >/opt/rabbitmq/etc/rabbitmq/rabbitmq-env.conf<<'EOF'
  # 数据目录（Mnesia 数据库、消息存储等）
  RABBITMQ_MNESIA_BASE=/data/rabbitmq/mnesia
  
  # 日志目录
  RABBITMQ_LOG_BASE=/data/rabbitmq/logs
  EOF
  ```

  







1. 声明交换机 `exchange.declare` 
2. 声明队列 `queue.declare`
3. 队列绑定到交换机 `queue.bind`
