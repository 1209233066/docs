<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://zero-dew.netlify.app/docs/database/mysql/">
<link rel="alternate" type="application/rss&#43;xml" href="https://zero-dew.netlify.app/docs/database/mysql/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>零露云</title>
<meta name="description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
<meta property="og:url" content="https://zero-dew.netlify.app/docs/database/mysql/">
  <meta property="og:site_name" content="零露云">
  <meta property="og:title" content="零露云">
  <meta property="og:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="零露云">
  <meta itemprop="description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
  <meta itemprop="datePublished" content="2025-05-25T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-05-25T00:00:00+00:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="零露云">
  <meta name="twitter:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
<link rel="preload" href="/scss/main.min.18c08ee35308968138c55945e86231cae563e39470a6efcb36f516f6b21b6a02.css" as="style" integrity="sha256-GMCO41MIloE4xVlF6GIxyuVj45Rwpu/LNvUW9rIbagI=" crossorigin="anonymous">
<link href="/scss/main.min.18c08ee35308968138c55945e86231cae563e39470a6efcb36f516f6b21b6a02.css" rel="stylesheet" integrity="sha256-GMCO41MIloE4xVlF6GIxyuVj45Rwpu/LNvUW9rIbagI=" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">零露云</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/about"><i class="fa-solid fa-house"></i><span>关于</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/docs"><i class="fa-solid fa-book"></i><span>文档</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/blog"><i class="fa-solid fa-blog"></i><span>博客</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/google/docsy/" target="_blank" rel="noopener"><i class='fa-brands fa-github'></i><span></span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.a779bd279239ad7d8c03caec2282ddc3.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="25"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/database/mysql/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title"></h1>





    <ul>
    
  
  
  
  

  
    
    
	

    <li><a href="#pg-ab65920c557ab2b33439fc56e73645b6">install mysql5.6</a></li>



    
  
    
    
	

    <li><a href="#pg-aa85c31520ed761c10303a065029e27b">install mysql5.7</a></li>



    
  
    
    
	

    <li><a href="#pg-c2bad65068c0dc6f4d1427dce06dd4fd">master_slave</a></li>



    
  
    
    
	

    <li><a href="#pg-0e11fa2ec489b8755847ce6778235e54">mha</a></li>



    
  
    
    
	

    <li><a href="#pg-b808a50b951bb2eae264b55dcb7e33fc">mgr</a></li>



    
  
    
    
	

    <li><a href="#pg-c8013d862a736f0c8b81cda693116416">mysqldump</a></li>



    
  
    
    
	

    <li><a href="#pg-ce9d44ed09004288aefaac879ed320af">xtrabackup</a></li>



    
  
    
    
	

    <li><a href="#pg-4bf71c58d88b7380dd55e728c09e47c2">config</a></li>



    
  
    
    
	

    <li><a href="#pg-a051ebfaac6fc3a51384fae8d41525a3">mysql数据库搬迁</a></li>



    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    


  

<div class="td-content" style="">
    <h1 id="pg-ab65920c557ab2b33439fc56e73645b6">install mysql5.6</h1>
	<div class="lead">mysql 5.6版本二进制安装和编译安装</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-28" class="text-body-secondary">Monday, July 28, 2025</time>
        
	</div>
	<h3 id="部署安装">部署安装</h3>
<ul>
<li>
<p>实例名称 <code>mysql-01</code> 示例使用全局变量引用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export clsName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mysql-01&#39;</span>
</span></span></code></pre></div></li>
</ul>
<ol>
<li>
<p>添加用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>useradd -s /sbin/nologin -u <span style="color:#ae81ff">3306</span> -M mysql
</span></span></code></pre></div><p>安装mysql依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># libaio提供 Linux 原生异步 I/O（AIO）支持，允许程序发起非阻塞的磁盘读写操作，提高高并发场景下的 I/O 性能</span>
</span></span><span style="display:flex;"><span>yum install -y libaio libaio-devel ncurses ncurses-devel cpanminus
</span></span></code></pre></div></li>
<li>
<p>mysql软件安装，示例安装在<code>/opt/mysql</code>目录下</p>

    
    
    
<ul class="nav nav-tabs justify-content-end" id="tabs-0" role="tablist">
  <li class="nav-item">
      <button class="nav-link disabled"
          id="tabs-00-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-00" role="tab"
          aria-controls="tabs-00-00" aria-selected="false">
        <strong>软件安装</strong>:
      </button>
    </li><li class="nav-item">
      <button class="nav-link active"
          id="tabs-00-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-01" role="tab"
          data-td-tp-persist="二进制安装" aria-controls="tabs-00-01" aria-selected="true">
        二进制安装
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-00-02-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-02" role="tab"
          data-td-tp-persist="编译安装" aria-controls="tabs-00-02" aria-selected="false">
        编译安装
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-0-content">
    <div class="tab-body tab-pane fade"
        id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab" tabindex="0">
        
    </div>
    <div class="tab-body tab-pane fade show active"
        id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab" tabindex="0">
        <p><em>软件下载</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tar xf mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz -C /opt
</span></span></code></pre></div><p><em>安装到/opt/mysql下</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ln -svf /opt/<span style="color:#f92672">{</span>mysql-5.6.40-linux-glibc2.12-x86_64,mysql<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ln -svf /opt/mysql-5.6.40-linux-glibc2.12-x86_64/bin/mysql /usr/bin/mysql
</span></span></code></pre></div>
    </div>
    <div class="tab-body tab-pane fade"
        id="tabs-00-02" role="tabpanel" aria-labelled-by="tabs-00-02-tab" tabindex="0">
        <p><em>软件下载</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.40.tar.gz
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tar xf mysql-5.6.40.tar.gz -C /opt
</span></span><span style="display:flex;"><span>cd /opt/mysql-5.6.40
</span></span></code></pre></div><p><em>安装编译依赖</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install -y cmake  libaio-devel  gcc-c++ perl-devel cpanminus ncurses-devel
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cmake . -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span>/opt/mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DMYSQL_DATADIR<span style="color:#f92672">=</span>/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DMYSQL_UNIX_ADDR<span style="color:#f92672">=</span>/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DDEFAULT_CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DDEFAULT_COLLATION<span style="color:#f92672">=</span>utf8_general_ci <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_EXTRA_CHARSETs<span style="color:#f92672">=</span>all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_INNOBASE_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_FEDERATED_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_BLACKHOLE_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_EXAMPLE_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_ZLIB<span style="color:#f92672">=</span>bundled <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_SSL<span style="color:#f92672">=</span>bundled <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DENABLED_LOCAL_INFILE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_EMBEDDED_SERVER<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DENABLE_DOWNLOADS<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_DEBUG<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make -j <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> make install
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ln -svf /opt/mysql/bin/mysql /usr/bin/mysql
</span></span></code></pre></div>
    </div>
</div>

</li>
<li>
<p>初始化</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 构建目录结构</span>
</span></span><span style="display:flex;"><span>mkdir -p /data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/<span style="color:#f92672">{</span>data,binlog,logs,relay_log,conf<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>chown -R mysql:mysql /data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始化数据库</span>
</span></span><span style="display:flex;"><span>/opt/mysql/scripts/mysql_install_db <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--basedir<span style="color:#f92672">=</span>/opt/mysql/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--datadir<span style="color:#f92672">=</span>/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--explicit_defaults_for_timestamp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span>mysql
</span></span></code></pre></div>
<details>
  <summary>Details</summary>
  <pre tabindex="0"><code class="language-log" data-lang="log">[root@seagullcore01-uat-s2 ~]# /opt/mysql/scripts/mysql_install_db \
&gt; --basedir=/opt/mysql/ \
&gt; --datadir=/data/instances/${clsName}/data \
&gt; --explicit_defaults_for_timestamp \
&gt; --user=mysql
Installing MySQL system tables...2025-07-28 11:23:40 0 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.
2025-07-28 11:23:40 0 [Note] /opt/mysql//bin/mysqld (mysqld 5.6.40) starting as process 29771 ...
2025-07-28 11:23:40 29771 [Note] InnoDB: Using atomics to ref count buffer pool pages
2025-07-28 11:23:40 29771 [Note] InnoDB: The InnoDB memory heap is disabled
2025-07-28 11:23:40 29771 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
2025-07-28 11:23:40 29771 [Note] InnoDB: Memory barrier is not used
2025-07-28 11:23:40 29771 [Note] InnoDB: Compressed tables use zlib 1.2.3
2025-07-28 11:23:40 29771 [Note] InnoDB: Using Linux native AIO
2025-07-28 11:23:40 29771 [Note] InnoDB: Using CPU crc32 instructions
2025-07-28 11:23:40 29771 [Note] InnoDB: Initializing buffer pool, size = 128.0M
2025-07-28 11:23:40 29771 [Note] InnoDB: Completed initialization of buffer pool
2025-07-28 11:23:40 29771 [Note] InnoDB: The first specified data file ./ibdata1 did not exist: a new database to be created!
2025-07-28 11:23:40 29771 [Note] InnoDB: Setting file ./ibdata1 size to 12 MB
2025-07-28 11:23:40 29771 [Note] InnoDB: Database physically writes the file full: wait...
2025-07-28 11:23:40 29771 [Note] InnoDB: Setting log file ./ib_logfile101 size to 48 MB
2025-07-28 11:23:40 29771 [Note] InnoDB: Setting log file ./ib_logfile1 size to 48 MB
2025-07-28 11:23:40 29771 [Note] InnoDB: Renaming log file ./ib_logfile101 to ./ib_logfile0
2025-07-28 11:23:40 29771 [Warning] InnoDB: New log files created, LSN=45781
2025-07-28 11:23:40 29771 [Note] InnoDB: Doublewrite buffer not found: creating new
2025-07-28 11:23:40 29771 [Note] InnoDB: Doublewrite buffer created
2025-07-28 11:23:40 29771 [Note] InnoDB: 128 rollback segment(s) are active.
2025-07-28 11:23:40 29771 [Warning] InnoDB: Creating foreign key constraint system tables.
2025-07-28 11:23:40 29771 [Note] InnoDB: Foreign key constraint system tables created
2025-07-28 11:23:40 29771 [Note] InnoDB: Creating tablespace and datafile system tables.
2025-07-28 11:23:40 29771 [Note] InnoDB: Tablespace and datafile system tables created.
2025-07-28 11:23:40 29771 [Note] InnoDB: Waiting for purge to start
2025-07-28 11:23:40 29771 [Note] InnoDB: 5.6.40 started; log sequence number 0
2025-07-28 11:23:41 29771 [Note] Binlog end
2025-07-28 11:23:41 29771 [Note] InnoDB: FTS optimize thread exiting.
2025-07-28 11:23:41 29771 [Note] InnoDB: Starting shutdown...
2025-07-28 11:23:42 29771 [Note] InnoDB: Shutdown completed; log sequence number 1625977
OK

Filling help tables...2025-07-28 11:23:42 0 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.
2025-07-28 11:23:42 0 [Note] /opt/mysql//bin/mysqld (mysqld 5.6.40) starting as process 29794 ...
2025-07-28 11:23:42 29794 [Note] InnoDB: Using atomics to ref count buffer pool pages
2025-07-28 11:23:42 29794 [Note] InnoDB: The InnoDB memory heap is disabled
2025-07-28 11:23:42 29794 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
2025-07-28 11:23:42 29794 [Note] InnoDB: Memory barrier is not used
2025-07-28 11:23:42 29794 [Note] InnoDB: Compressed tables use zlib 1.2.3
2025-07-28 11:23:42 29794 [Note] InnoDB: Using Linux native AIO
2025-07-28 11:23:42 29794 [Note] InnoDB: Using CPU crc32 instructions
2025-07-28 11:23:42 29794 [Note] InnoDB: Initializing buffer pool, size = 128.0M
2025-07-28 11:23:42 29794 [Note] InnoDB: Completed initialization of buffer pool
2025-07-28 11:23:42 29794 [Note] InnoDB: Highest supported file format is Barracuda.
2025-07-28 11:23:42 29794 [Note] InnoDB: 128 rollback segment(s) are active.
2025-07-28 11:23:42 29794 [Note] InnoDB: Waiting for purge to start
2025-07-28 11:23:43 29794 [Note] InnoDB: 5.6.40 started; log sequence number 1625977
2025-07-28 11:23:43 29794 [Note] Binlog end
2025-07-28 11:23:43 29794 [Note] InnoDB: FTS optimize thread exiting.
2025-07-28 11:23:43 29794 [Note] InnoDB: Starting shutdown...
2025-07-28 11:23:44 29794 [Note] InnoDB: Shutdown completed; log sequence number 1625987
OK

To start mysqld at boot time you have to copy
support-files/mysql.server to the right place for your system

PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
To do so, start the server, then issue the following commands:

  /opt/mysql//bin/mysqladmin -u root password &#39;new-password&#39;
  /opt/mysql//bin/mysqladmin -u root -h seagullcore01-uat-s2 password &#39;new-password&#39;

Alternatively you can run:

  /opt/mysql//bin/mysql_secure_installation

which will also give you the option of removing the test
databases and anonymous user created by default.  This is
strongly recommended for production servers.

See the manual for more instructions.

You can start the MySQL daemon with:

  cd . ; /opt/mysql//bin/mysqld_safe &amp;

You can test the MySQL daemon with mysql-test-run.pl

  cd mysql-test ; perl mysql-test-run.pl

Please report any problems at http://bugs.mysql.com/

The latest information about MySQL is available on the web at

  http://www.mysql.com

Support MySQL by buying support/licenses at http://shop.mysql.com

New default config file was created as /opt/mysql//my.cnf and
will be used by default by the server when you start it.
You may edit this file to change server settings

WARNING: Default config file /etc/my.cnf exists on the system
This file will be read by default by the MySQL server
If you do not want to use this, either remove it, or use the
--defaults-file argument to mysqld_safe when starting the server
</code></pre></details>

</li>
<li>
<p>启动服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat &gt;/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/conf/my.cnf<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">performance_schema=ON
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server_id=1921680152
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character-set-server=utf8mb4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/opt/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/data/instances/${clsName}/data/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/data/instances/${clsName}/mysql.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/data/instances/${clsName}/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log_error=/data/instances/${clsName}/logs/mysql-error.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slow_query_log_file=/data/instances/${clsName}/logs/mysql_slow_query.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slow_query_log=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">long_query_time=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format=row
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin=/data/instances/${clsName}/binlog/log_bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin-index=/data/instances/${clsName}/binlog/binlog.index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#gtid-mode=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#enforce-gtid-consistency=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log=/data/instances/${clsName}/relay_log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log_index=/data/instances/${clsName}/relaylog/relay-bin.index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log_recovery=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_authentication_plugin=mysql_native_password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">master_info_repository=table
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log_info_repository=table
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tee /usr/lib/systemd/system/mysql.service <span style="color:#e6db74">&lt;&lt;&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=mysql service https://dev.mysql.com/doc/refman/5.6/en
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/mysql/bin/mysqld_safe \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--defaults-file=/data/instances/mysql-01/conf/my.cnf \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--pid-file=/data/instances/mysql-01/mysql.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 设置最大文件描述符
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=1024
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 设置CPU使用率限制为50%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CPUQuota=50%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 设置内存限制为1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MemoryLimit=1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl enable mysql --now
</span></span><span style="display:flex;"><span>systemctl status  mysql
</span></span></code></pre></div></li>
<li>
<p>创建用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 修改root密码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>; 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 超管用户
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span> ;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 管理用户
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;rdsAdmin&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;rdsAdmin&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>  ; 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 复制用户
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;rdsRpl&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION SLAVE, REPLICATION CLIENT <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;rdsRpl&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div></li>
</ol>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-aa85c31520ed761c10303a065029e27b">install mysql5.7</h1>
	<div class="lead">mysql 5.7版本二进制安装和编译安装</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-28" class="text-body-secondary">Monday, July 28, 2025</time>
        
	</div>
	<h3 id="部署安装">部署安装</h3>
<ul>
<li>
<p>实例名称 <code>mysql-01</code> 示例使用全局变量引用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export clsName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mysql-01&#39;</span>
</span></span></code></pre></div></li>
</ul>
<ol>
<li>
<p>添加用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>useradd -s /sbin/nologin -u <span style="color:#ae81ff">3306</span> -M mysql
</span></span></code></pre></div><p>安装mysql依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># libaio提供 Linux 原生异步 I/O（AIO）支持，允许程序发起非阻塞的磁盘读写操作，提高高并发场景下的 I/O 性能</span>
</span></span><span style="display:flex;"><span>yum install -y libaio libaio-devel ncurses ncurses-devel cpanminus
</span></span></code></pre></div></li>
<li>
<p>mysql软件安装，示例安装在<code>/opt/mysql</code>目录下</p>

    
    
    
<ul class="nav nav-tabs justify-content-end" id="tabs-0" role="tablist">
  <li class="nav-item">
      <button class="nav-link disabled"
          id="tabs-00-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-00" role="tab"
          aria-controls="tabs-00-00" aria-selected="false">
        <strong>软件安装</strong>:
      </button>
    </li><li class="nav-item">
      <button class="nav-link active"
          id="tabs-00-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-01" role="tab"
          data-td-tp-persist="二进制安装" aria-controls="tabs-00-01" aria-selected="true">
        二进制安装
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-00-02-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-02" role="tab"
          data-td-tp-persist="编译安装" aria-controls="tabs-00-02" aria-selected="false">
        编译安装
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-0-content">
    <div class="tab-body tab-pane fade"
        id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab" tabindex="0">
        
    </div>
    <div class="tab-body tab-pane fade show active"
        id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab" tabindex="0">
        <p><em>软件下载</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.40-linux-glibc2.12-x86_64.tar.gz
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tar xf mysql-5.7.40-linux-glibc2.12-x86_64.tar.gz -C /opt
</span></span></code></pre></div><p><em>安装到/opt/mysql下</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ln -svf /opt/<span style="color:#f92672">{</span>mysql-5.7.40-linux-glibc2.12-x86_64,mysql<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ln -svf /opt/mysql-5.7.40-linux-glibc2.12-x86_64/bin/mysql /usr/bin/mysql
</span></span></code></pre></div>
    </div>
    <div class="tab-body tab-pane fade"
        id="tabs-00-02" role="tabpanel" aria-labelled-by="tabs-00-02-tab" tabindex="0">
        <p><em>软件下载,5.7.5之后的版本需要boost</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://downloads.mysql.com/archives/get/p/23/file/mysql-boost-5.7.40.tar.gz
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tar xf mysql-boost-5.7.40.tar.gz -C /opt
</span></span><span style="display:flex;"><span>cd /opt/mysql-5.7.40
</span></span></code></pre></div><p><em>安装编译依赖</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install -y cmake  libaio-devel  gcc-c++ perl-devel cpanminus ncurses-devel
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cmake . -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span>/opt/mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DMYSQL_DATADIR<span style="color:#f92672">=</span>/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DMYSQL_UNIX_ADDR<span style="color:#f92672">=</span>/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DDEFAULT_CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DDEFAULT_COLLATION<span style="color:#f92672">=</span>utf8_general_ci <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_EXTRA_CHARSETs<span style="color:#f92672">=</span>all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_INNOBASE_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_FEDERATED_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_BLACKHOLE_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_EXAMPLE_STORAGE_ENGINE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_ZLIB<span style="color:#f92672">=</span>system <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_SSL<span style="color:#f92672">=</span>system <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DENABLED_LOCAL_INFILE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_EMBEDDED_SERVER<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DENABLE_DOWNLOADS<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_DEBUG<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-DWITH_BOOST<span style="color:#f92672">=</span>boost
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make -j <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> make install
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ln -svf /opt/mysql/bin/mysql /usr/bin/mysql
</span></span></code></pre></div>
    </div>
</div>

</li>
<li>
<p>初始化</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 构建目录结构</span>
</span></span><span style="display:flex;"><span>mkdir -p /data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/<span style="color:#f92672">{</span>data,binlog,logs,relay_log,conf<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>chown -R mysql:mysql /data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>配置文件


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">mysql从5.7开始支持 GTID(Global Transaction Identifiers)，开启gtid功能配置如下：</h4>

    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">gtid-mode</span><span style="color:#f92672">=</span><span style="color:#e6db74">on</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">enforce-gtid-consistency</span><span style="color:#f92672">=</span><span style="color:#e6db74">on</span>
</span></span></code></pre></div>

</div>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat &gt;/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/conf/my.cnf<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">performance_schema=ON
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server_id=1921680152
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character-set-server=utf8mb4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/opt/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/data/instances/${clsName}/data/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/data/instances/${clsName}/mysql.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/data/instances/${clsName}/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log_error=/data/instances/${clsName}/logs/mysql-error.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slow_query_log_file=/data/instances/${clsName}/logs/mysql_slow_query.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slow_query_log=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">long_query_time=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log_timestamps=SYSTEM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format=row
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin=/data/instances/${clsName}/binlog/log_bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin-index=/data/instances/${clsName}/binlog/binlog.index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gtid-mode=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enforce-gtid-consistency=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log=/data/instances/${clsName}/relay_log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log_index=/data/instances/${clsName}/relaylog/relay-bin.index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log_recovery=on
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_authentication_plugin=mysql_native_password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">master_info_repository=table
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay_log_info_repository=table
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><p>初始化数据库


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">查看初始化密码</h4>

    <code>cat /data/instances/${clsName}/logs/mysql-error.log</code>

</div>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/opt/mysql/bin/mysqld --defaults-file<span style="color:#f92672">=</span>/data/instances/<span style="color:#e6db74">${</span>clsName<span style="color:#e6db74">}</span>/conf/my.cnf --user<span style="color:#f92672">=</span>mysql --initialize
</span></span></code></pre></div></li>
<li>
<p>启动服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tee /usr/lib/systemd/system/mysql.service <span style="color:#e6db74">&lt;&lt;&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=mysql service https://dev.mysql.com/doc/refman/5.7/en
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/mysql/bin/mysqld_safe \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--defaults-file=/data/instances/mysql-01/conf/my.cnf \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--pid-file=/data/instances/mysql-01/mysql.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 设置最大文件描述符
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=1024
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 设置CPU使用率限制为50%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CPUQuota=50%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 设置内存限制为1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MemoryLimit=1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl enable mysql --now
</span></span><span style="display:flex;"><span>systemctl status  mysql
</span></span></code></pre></div></li>
<li>
<p>创建用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 修改root密码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>; 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 超管用户
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span> ;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 管理用户
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;rdsAdmin&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;rdsAdmin&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>  ; 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--- 复制用户
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;rdsRpl&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;li&lt;)&lt;#jyi9S)2024&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION SLAVE, REPLICATION CLIENT <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;rdsRpl&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div></li>
</ol>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-c2bad65068c0dc6f4d1427dce06dd4fd">master_slave</h1>
	<div class="lead">mysql主从同步的原理和实现</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-04" class="text-body-secondary">Friday, July 04, 2025</time>
        
	</div>
	<table>
    <tr>
        <td><img src="/docs/database/mysql/主从架构.png" alt="主从架构图"></td>
        <td><img src="/docs/database/mysql/主从复制原理.png" alt="主从复制原理"></td>
    </tr>
</table>
<hr>
<h3 id="mater-slave-实现">Mater-Slave 实现</h3>
<p>主从是一种异步同步，主库在执行完客户端提交的事务后会立即将结果返回给客户端，并不关心从库是否已经接收并处理。


<div class="alert alert-warning" role="alert">


    <ol>
<li>主库开启binlog</li>
<li>主从之间设置不同的server_id</li>
<li>从库设置为只读，防止多点写入</li>
</ol>


</div>
</p>
<hr>

  
  
  
<ul class="nav nav-tabs" id="tabs-1" role="tablist">
  <li class="nav-item">
      <button class="nav-link disabled"
          id="tabs-01-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-00" role="tab"
          aria-controls="tabs-01-00" aria-selected="false">
        <strong>搭建主备关系</strong>:
      </button>
    </li><li class="nav-item">
      <button class="nav-link active"
          id="tabs-01-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-01" role="tab"
          data-td-tp-persist="主库" aria-controls="tabs-01-01" aria-selected="true">
        主库
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-01-02-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-02" role="tab"
          data-td-tp-persist="从库" aria-controls="tabs-01-02" aria-selected="false">
        从库
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-1-content">
    <div class="tab-body tab-pane fade"
        id="tabs-01-00" role="tabpanel" aria-labelled-by="tabs-01-00-tab" tabindex="1">
        
    </div>
    <div class="tab-body tab-pane fade show active"
        id="tabs-01-01" role="tabpanel" aria-labelled-by="tabs-01-01-tab" tabindex="1">
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;replUser&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED  <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;RsU#58d1@&#39;</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION SLAVE,REPLICATION CLIENT <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;replUser&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>; 
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SHOW</span> MASTER STATUS;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">----------------+----------+--------------+------------------+------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> File           <span style="color:#f92672">|</span> <span style="color:#66d9ef">Position</span> <span style="color:#f92672">|</span> Binlog_Do_DB <span style="color:#f92672">|</span> Binlog_Ignore_DB <span style="color:#f92672">|</span> Executed_Gtid_Set                        <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">----------------+----------+--------------+------------------+------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> log_bin.<span style="color:#ae81ff">000002</span> <span style="color:#f92672">|</span>      <span style="color:#ae81ff">551</span> <span style="color:#f92672">|</span>              <span style="color:#f92672">|</span>                  <span style="color:#f92672">|</span> b2a464ed<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>c16<span style="color:#f92672">-</span><span style="color:#ae81ff">11</span>f0<span style="color:#f92672">-</span><span style="color:#ae81ff">8445</span><span style="color:#f92672">-</span><span style="color:#ae81ff">000</span>c299bad95:<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">----------------+----------+--------------+------------------+------------------------------------------+
</span></span></span></code></pre></div><p><strong>同步指定库/表</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">在主库的配置文件中执行</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[mysqld]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">binlog-do-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">mysql</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">binlog-do-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">radius</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">binlog-ignore-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">syslog</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">binlog-ignore-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">sys</span>
</span></span></code></pre></div>
    </div>
    <div class="tab-body tab-pane fade"
        id="tabs-01-02" role="tabpanel" aria-labelled-by="tabs-01-02-tab" tabindex="1">
        <h3 id="57-之前没有开启gtid的数据库">5.7 之前没有开启gtid的数据库</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">reset</span> slave <span style="color:#66d9ef">all</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CHANGE MASTER <span style="color:#66d9ef">TO</span> 
</span></span><span style="display:flex;"><span>  MASTER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;10.128.99.157&#39;</span>,
</span></span><span style="display:flex;"><span>  MASTER_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span>,
</span></span><span style="display:flex;"><span>  MASTER_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rdsRpl&#39;</span>,
</span></span><span style="display:flex;"><span>  MASTER_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RsU#58d1@&#39;</span>,
</span></span><span style="display:flex;"><span>  master_log_file<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_bin.000002&#39;</span>,
</span></span><span style="display:flex;"><span>  MASTER_LOG_POS<span style="color:#f92672">=</span><span style="color:#ae81ff">551</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">start</span> slave;<span style="color:#66d9ef">show</span> slave status <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- 设置只读
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>;
</span></span></code></pre></div><h3 id="57-及之后版本开始gtid的数据库">5.7 及之后版本开始gtid的数据库</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">reset</span> slave <span style="color:#66d9ef">all</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">--- 重置gtid执行历史
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">reset</span> slave <span style="color:#66d9ef">all</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">reset</span> master;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SET</span> <span style="color:#f92672">@@</span><span style="color:#66d9ef">GLOBAL</span>.GTID_PURGED<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;b2a464ed-6c16-11f0-8445-000c299bad95:1-2&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>CHANGE MASTER <span style="color:#66d9ef">TO</span> 
</span></span><span style="display:flex;"><span>  MASTER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;10.128.99.157&#39;</span>,
</span></span><span style="display:flex;"><span>  MASTER_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span>,
</span></span><span style="display:flex;"><span>  MASTER_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rdsRpl&#39;</span>,
</span></span><span style="display:flex;"><span>  MASTER_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RsU#58d1@&#39;</span>,
</span></span><span style="display:flex;"><span>  MASTER_AUTO_POSITION<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">start</span> slave;<span style="color:#66d9ef">show</span> slave status <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">关键指标：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Slave_IO_Running: Yes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Slave_SQL_Running: Yes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Seconds_Behind_Master: 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- 设置只读
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>;
</span></span></code></pre></div><p><strong>同步指定库/表&ndash;在配置文件中指定</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">或在从库的配置文件中指定</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[mysqld] </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">replicate-do-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">mysql</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">replicate-do-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">radius</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">replicate-ignore-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">syslog</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">replicate-ignore-db</span><span style="color:#f92672">=</span><span style="color:#e6db74">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 通配符表级</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">replication-wild-do-table</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">db1.user_% </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">replication-wild-ignore-table</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">db1.log_%</span>
</span></span></code></pre></div><p><strong>同步指定库/表&ndash;动态修改</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- 停止 SQL 线程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>STOP SLAVE SQL_THREAD;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 修改过滤规则
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CHANGE REPLICATION FILTER
</span></span><span style="display:flex;"><span>    REPLICATE_DO_DB <span style="color:#f92672">=</span> (db1, db2),
</span></span><span style="display:flex;"><span>    REPLICATE_IGNORE_TABLE <span style="color:#f92672">=</span> (db3.log);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 重新启动 SQL 线程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">START</span> SLAVE SQL_THREAD;
</span></span></code></pre></div>
    </div>
</div>

<h3 id="主从报错处理">主从报错处理</h3>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">从库连接异常</h4>

    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>Slave_IO_Running: Connecting
</span></span><span style="display:flex;"><span>Last_IO_Errno: <span style="color:#ae81ff">1045</span>
</span></span><span style="display:flex;"><span>Last_IO_Error: error connecting <span style="color:#66d9ef">to</span> master <span style="color:#e6db74">&#39;rep@168.101.1.177:3306&#39;</span> <span style="color:#f92672">-</span> retry<span style="color:#f92672">-</span>time: <span style="color:#ae81ff">60</span>  retries: <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p><strong>处理办法</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">update</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span>password(<span style="color:#e6db74">&#39;rep&#39;</span>) <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rep&#39;</span>;
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div>

</div>



<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">从库sql线程错误</h4>

    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">跳过主从复制的</span>sql线程错误
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> sql_slve_skip_counter  <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div>

</div>


</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-0e11fa2ec489b8755847ce6778235e54">mha</h1>
	<div class="lead">mha是使用ruby语言实现的高可用方案</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-28" class="text-body-secondary">Monday, July 28, 2025</time>
        
	</div>
	<table>
  <thead>
      <tr>
          <th>主机名</th>
          <th>IP</th>
          <th>server_id</th>
          <th>角色</th>
          <th>版本</th>
          <th>设置</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>mysqldbphw01</td>
          <td>172.32.4.10/24</td>
          <td>1</td>
          <td><code>master</code>/<code>MHA Node</code></td>
          <td>5.6.40</td>
          <td>1.设置server-id<br>2.开启binlog<br>3.配置vip 172.32.4.50/24</td>
      </tr>
      <tr>
          <td>mysqldbphw02</td>
          <td>172.32.4.20/24</td>
          <td>2</td>
          <td><code>slave</code>/<code>MHA Node</code></td>
          <td>5.6.40</td>
          <td>1.设置server-id<br>2.设置为只读</td>
      </tr>
      <tr>
          <td>mysqldbphw03</td>
          <td>172.32.4.30/24</td>
          <td>3</td>
          <td><code>slave</code>/<code>MHA Node</code></td>
          <td>5.6.40</td>
          <td>1.设置server-id<br/>2.设置为只读</td>
      </tr>
      <tr>
          <td>mysqldbphw04</td>
          <td>172.32.4.40/24</td>
          <td></td>
          <td><code>MHA Manager</code></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>

<div class="alert alert-primary" role="alert">


    <ul>
<li>添加一个vip 用于应用接入</li>
<li>设置ssh免密要认证，用于failover时执行网络、binlog拷贝等动作</li>
</ul>


</div>
</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ifconfig eth0:2 172.32.4.50/24
</span></span><span style="display:flex;"><span>ssh-keygen -t rsa -f /root/.ssh/id_rsa -N <span style="color:#e6db74">&#34;&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>2.5测试
</span></span><span style="display:flex;"><span>主库手工绑定vip：ifconfig eth0:1 168.204.37.17/24 up 
</span></span><span style="display:flex;"><span>masterha_check_ssh --conf<span style="color:#f92672">=</span>/etc/mha/app1.cnf 
</span></span><span style="display:flex;"><span>masterha_check_repl --conf<span style="color:#f92672">=</span>/etc/mha/app1.cnf
</span></span><span style="display:flex;"><span>2.6启动
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@mysqldbphw04 /<span style="color:#f92672">]</span><span style="color:#75715e"># nohup masterha_manager --conf=/etc/mha/app1.cnf &gt; /mha/manager.log &lt; /dev/null &amp;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> <span style="color:#ae81ff">933</span>
</span></span><span style="display:flex;"><span>查看运行状态
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@mysqldbphw04 /<span style="color:#f92672">]</span><span style="color:#75715e"># masterha_check_status --conf=/etc/mha/app1.cnf</span>
</span></span><span style="display:flex;"><span>app1 <span style="color:#f92672">(</span>pid:933<span style="color:#f92672">)</span> is running<span style="color:#f92672">(</span>0:PING_OK<span style="color:#f92672">)</span>, master:mysqldbphw01
</span></span><span style="display:flex;"><span>2.7关闭
</span></span><span style="display:flex;"><span>masterha_sotp  --conf<span style="color:#f92672">=</span>/etc/mha/app1.cnf
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@mysqldbphw04 /<span style="color:#f92672">]</span><span style="color:#75715e"># masterha_secondary_check -s mysqldbphw01 -s  mysqldbp</span>
</span></span><span style="display:flex;"><span>hw02  -s mysqldbphw03 --user<span style="color:#f92672">=</span>root --master_host<span style="color:#f92672">=</span>mysqldbphw01 --master_ip<span style="color:#f92672">=</span><span style="color:#ae81ff">172</span>
</span></span><span style="display:flex;"><span>.32.4.10 --master_port<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>Master is reachable from mysqldbphw01!
</span></span></code></pre></div><p><a href="https://www.cnblogs.com/xiaoyuxixi/p/13814811.html" target="_blank">MYSQL高可用架构MGR、MHA对比 - 小雨淅淅o0 - 博客园 (cnblogs.com)</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-b808a50b951bb2eae264b55dcb7e33fc">mgr</h1>
	<div class="lead">MGR是 MySQL 官方提供的高可用、高一致性的分布式数据库解决方案</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-28" class="text-body-secondary">Monday, July 28, 2025</time>
        
	</div>
	<p>MySQL Group Replication（MGR）是 MySQL 官方提供的高可用、高一致性的分布式数据库解决方案，基于原生 MySQL 实现多主/单主架构的同步复制。其核心原理是通过 Paxos 协议变种（Group Communication System, GCS） 实现节点间的数据强一致性，MGR和传统主从复制的本质区别——不是简单的异步复制改进，而是基于paxos的同步复制。</p>
<ul>
<li>使用 <strong>Paxos 分布式共识算法</strong>（具体实现为 <code>XCom</code>）确保集群内节点状态一致。</li>
<li>所有事务需在组内<strong>多数节点（N/2+1）</strong> 确认后才提交（避免脑裂）。</li>
<li>通信基于 <strong>MySQL 插件 <code>group_replication</code></strong> 实现。</li>
</ul>
<pre class="mermaid">graph LR
A[客户端发起事务] --&gt; B[本地节点执行]
B --&gt; C[生成Binlog Event]
C --&gt; D[广播到组内所有节点]
D --&gt; E[多数节点验证冲突]
E --&gt; F{多数节点通过?}
F --&gt;|Yes| G[提交事务并通知组]
F --&gt;|No| H[回滚事务]</pre>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-c8013d862a736f0c8b81cda693116416">mysqldump</h1>
	<div class="lead">mysqldump逻辑备份工具</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-28" class="text-body-secondary">Monday, July 28, 2025</time>
        
	</div>
	

<div class="alert alert-warning" role="alert">


    <ol>
<li><strong>InnoDB 优先用 <code>--single-transaction</code></strong>，避免锁表影响业务。</li>
<li><strong>MyISAM 必须锁表</strong>（默认行为），需在低峰期操作。</li>
<li><strong>大表备份</strong>：结合 <code>--quick</code> 和输出压缩（如 <code>gzip</code>）。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--备份前先执行flush tables 将内容写入磁盘（mysql必知必会中提到）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>flush tables ;
</span></span></code></pre></div>

</div>


  
  
  
<ul class="nav nav-tabs" id="tabs-1" role="tablist">
  <li class="nav-item">
      <button class="nav-link disabled"
          id="tabs-01-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-00" role="tab"
          aria-controls="tabs-01-00" aria-selected="false">
        <strong>逻辑备份</strong>:
      </button>
    </li><li class="nav-item">
      <button class="nav-link active"
          id="tabs-01-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-01" role="tab"
          data-td-tp-persist="备份所有库" aria-controls="tabs-01-01" aria-selected="true">
        备份所有库
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-01-02-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-02" role="tab"
          data-td-tp-persist="备份指定库" aria-controls="tabs-01-02" aria-selected="false">
        备份指定库
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-1-content">
    <div class="tab-body tab-pane fade"
        id="tabs-01-00" role="tabpanel" aria-labelled-by="tabs-01-00-tab" tabindex="1">
        
    </div>
    <div class="tab-body tab-pane fade show active"
        id="tabs-01-01" role="tabpanel" aria-labelled-by="tabs-01-01-tab" tabindex="1">
        <p>创建备份用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span>, <span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">VIEW</span>, RELOAD, <span style="color:#66d9ef">LOCK</span> TABLES, PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div><p>备份命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 备份所有数据库</span>
</span></span><span style="display:flex;"><span>/usr/local/mysql80/bin/mysqldump <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-A <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--single-transaction --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-u root -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> -h 10.128.99.157 -P <span style="color:#ae81ff">6301</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>|gzip &gt;/Backup/fullbackup<span style="color:#e6db74">`</span>date +%F-%H:%M:%S<span style="color:#e6db74">`</span>.sql.gz
</span></span></code></pre></div>
    </div>
    <div class="tab-body tab-pane fade"
        id="tabs-01-02" role="tabpanel" aria-labelled-by="tabs-01-02-tab" tabindex="1">
        <p>创建备份用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span>, <span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">VIEW</span>, RELOAD, <span style="color:#66d9ef">LOCK</span> TABLES, PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div><p>备份命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 备份指定数据库</span>
</span></span><span style="display:flex;"><span>/usr/local/mysql80/bin/mysqldump <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-B infra_settle <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--single-transaction --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-u root -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> -h 10.128.99.157 -P <span style="color:#ae81ff">6301</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>|gzip &gt;/Backup/fullbackup<span style="color:#e6db74">`</span>date +%F-%H:%M:%S<span style="color:#e6db74">`</span>.sql.gz
</span></span></code></pre></div>
    </div>
</div>

<table>
  <thead>
      <tr>
          <th style="text-align: left">参数</th>
          <th style="text-align: left">说明</th>
          <th style="text-align: left">示例</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>-u</code>, <code>--user</code></td>
          <td style="text-align: left">指定用户名</td>
          <td style="text-align: left"><code>-u root</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-p</code>, <code>--password</code></td>
          <td style="text-align: left">密码（建议不加密码，后续输入）</td>
          <td style="text-align: left"><code>-p</code> 或 <code>-p'123'</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-h</code>, <code>--host</code></td>
          <td style="text-align: left">MySQL 服务器地址</td>
          <td style="text-align: left"><code>-h 127.0.0.1</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-P</code>, <code>--port</code></td>
          <td style="text-align: left">端口号（默认3306）</td>
          <td style="text-align: left"><code>-P 6301</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--socket</code></td>
          <td style="text-align: left">指定 Unix Socket 文件路径</td>
          <td style="text-align: left"><code>--socket=/tmp/mysql.sock</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-A</code>, <code>--all-databases</code></td>
          <td style="text-align: left">备份所有数据库</td>
          <td style="text-align: left"><code>mysqldump -A &gt; full_backup.sql</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-B</code>, <code>--databases</code></td>
          <td style="text-align: left">备份指定数据库（可多个）</td>
          <td style="text-align: left"><code>-B db1 db2</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--tables</code></td>
          <td style="text-align: left">指定表（需先指定数据库）</td>
          <td style="text-align: left"><code>dbname --tables table1 table2</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--ignore-table</code></td>
          <td style="text-align: left">排除指定表</td>
          <td style="text-align: left"><code>--ignore-table=db.logs</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--no-data</code></td>
          <td style="text-align: left">仅备份表结构，不备份数据</td>
          <td style="text-align: left"><code>--no-data</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--no-create-info</code></td>
          <td style="text-align: left">仅备份数据，不备份表结构</td>
          <td style="text-align: left"><code>--no-create-info</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--routines</code></td>
          <td style="text-align: left">包含存储过程和函数</td>
          <td style="text-align: left"><code>--routines</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--triggers</code></td>
          <td style="text-align: left">包含触发器</td>
          <td style="text-align: left"><code>--triggers</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--events</code></td>
          <td style="text-align: left">包含事件调度器</td>
          <td style="text-align: left"><code>--events</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--skip-triggers</code></td>
          <td style="text-align: left">排除触发器</td>
          <td style="text-align: left"><code>--skip-triggers</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--single-transaction</code></td>
          <td style="text-align: left">开启事务保证 InnoDB 一致性快照</td>
          <td style="text-align: left">InnoDB</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--lock-tables</code></td>
          <td style="text-align: left">备份前锁定所有表（默认开启）</td>
          <td style="text-align: left">MyISAM</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--skip-lock-tables</code></td>
          <td style="text-align: left">不锁表（可能导致不一致）</td>
          <td style="text-align: left">紧急情况</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--flush-logs</code></td>
          <td style="text-align: left">备份前刷新日志（用于 Binlog 增量恢复）</td>
          <td style="text-align: left">所有引擎</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--master-data</code></td>
          <td style="text-align: left">记录 Binlog 位置（<code>=1</code>注释，<code>=2</code>SQL语句）</td>
          <td style="text-align: left">主从复制</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--result-file</code></td>
          <td style="text-align: left">指定输出文件（避免 Windows 换行问题）</td>
          <td style="text-align: left"><code>--result-file=backup.sql</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--compress</code></td>
          <td style="text-align: left">压缩传输（节省网络带宽）</td>
          <td style="text-align: left"><code>--compress</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--tz-utc</code></td>
          <td style="text-align: left">统一时区为 UTC（默认开启）</td>
          <td style="text-align: left"><code>--tz-utc</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--hex-blob</code></td>
          <td style="text-align: left">二进制数据以十六进制导出</td>
          <td style="text-align: left"><code>--hex-blob</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--quick</code></td>
          <td style="text-align: left">逐行导出（避免内存溢出）</td>
          <td style="text-align: left">大表备份</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--extended-insert</code></td>
          <td style="text-align: left">合并多行 INSERT（默认开启）</td>
          <td style="text-align: left">减少备份体积</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--skip-extended-insert</code></td>
          <td style="text-align: left">每行单独 INSERT（可读性高）</td>
          <td style="text-align: left">调试用途</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--opt</code></td>
          <td style="text-align: left">启用所有优化选项（默认开启）</td>
          <td style="text-align: left">综合优化</td>
      </tr>
  </tbody>
</table>
<p>备份脚本
<details>
  <summary>Details</summary>
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># 脚本名称: mysql_backup.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 描述: MySQL数据库备份脚本，支持全库备份、binlog同步及过期清理</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 作者: wangendao(1209233066@qq.com)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建日期: 2019/03/01</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 最后修改日期: $(date +%F)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 调试选项 (取消注释以启用)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># set -euo pipefail  # 更严格的错误检查</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># set -x            # 显示执行过程</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 配置变量</span>
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span>/application/mysql5.6/bin:$PATH
</span></span><span style="display:flex;"><span>datadir<span style="color:#f92672">=</span>/application/mysql5.6/
</span></span><span style="display:flex;"><span>backupdir<span style="color:#f92672">=</span>/backup
</span></span><span style="display:flex;"><span>logdir<span style="color:#f92672">=</span>/var/log/mysql_backup
</span></span><span style="display:flex;"><span>timestamp<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%F_%H%M%S<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>user<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;123&#39;</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/application/mysql5.6/mysql.sock
</span></span><span style="display:flex;"><span>rsync_ip<span style="color:#f92672">=</span>168.204.37.25
</span></span><span style="display:flex;"><span>retention_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>  <span style="color:#75715e"># 备份保留天数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建必要的目录</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#e6db74">&#34;</span>$backupdir<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$logdir<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 日志函数</span>
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;[</span><span style="color:#66d9ef">$(</span>date <span style="color:#e6db74">&#39;+%F %T&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">] </span>$1<span style="color:#e6db74">&#34;</span> &gt;&gt; <span style="color:#e6db74">&#34;</span>$logdir<span style="color:#e6db74">/mysql_backup_</span><span style="color:#e6db74">${</span>timestamp<span style="color:#e6db74">}</span><span style="color:#e6db74">.log&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 错误处理函数</span>
</span></span><span style="display:flex;"><span>error_exit<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;ERROR: </span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    sendEmail -f wangendao@crv.com.cn -t wangendao@crv.com.cn <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>              -s 10.248.2.15 -u <span style="color:#e6db74">&#34;MySQL备份失败警报&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>              -o tls<span style="color:#f92672">=</span>no -o message-content-type<span style="color:#f92672">=</span>html <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>              -o message-charset<span style="color:#f92672">=</span>utf8 -xu wangendao@crv.com.cn <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>              -xp Wed10203040 -m <span style="color:#e6db74">&#34;MySQL备份失败: </span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取数据库列表</span>
</span></span><span style="display:flex;"><span>DBlist<span style="color:#f92672">=(</span><span style="color:#66d9ef">$(</span>mysql -u <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>user<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -p<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -S <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>socket<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          -e <span style="color:#e6db74">&#34;SHOW DATABASES;&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          awk <span style="color:#e6db74">&#39;!/^(information_schema|performance_schema|test|database|mysql)$/&#39;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          tail -n +2<span style="color:#66d9ef">)</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">${#</span>DBlist[@]<span style="color:#e6db74">}</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    error_exit <span style="color:#e6db74">&#34;未获取到数据库列表&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 备份每个数据库</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> db in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DBlist[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    backup_file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>backupdir<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>db<span style="color:#e6db74">}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">${</span>timestamp<span style="color:#e6db74">}</span><span style="color:#e6db74">.gz&#34;</span>
</span></span><span style="display:flex;"><span>    md5_file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>backupdir<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>db<span style="color:#e6db74">}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">${</span>timestamp<span style="color:#e6db74">}</span><span style="color:#e6db74">.md5&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;开始备份数据库: </span>$db<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ! mysqldump -B <span style="color:#e6db74">&#34;</span>$db<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        -u<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>user<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -p<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -S <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>socket<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --single-transaction <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --routines <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --triggers | gzip &gt; <span style="color:#e6db74">&#34;</span>$backup_file<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        error_exit <span style="color:#e6db74">&#34;数据库 </span>$db<span style="color:#e6db74"> 备份失败&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 生成MD5校验文件</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ! md5sum <span style="color:#e6db74">&#34;</span>$backup_file<span style="color:#e6db74">&#34;</span> &gt; <span style="color:#e6db74">&#34;</span>$md5_file<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        error_exit <span style="color:#e6db74">&#34;无法生成MD5校验文件&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;数据库 </span>$db<span style="color:#e6db74"> 备份完成, 文件: </span>$backup_file<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 同步备份文件</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;开始同步备份文件到远程服务器&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ! rsync -az --delete <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>backupdir<span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span> <span style="color:#e6db74">&#34;rsync@</span><span style="color:#e6db74">${</span>rsync_ip<span style="color:#e6db74">}</span><span style="color:#e6db74">::ftp&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>     --password-file<span style="color:#f92672">=</span>/etc/rsync.password &gt;&gt; <span style="color:#e6db74">&#34;</span>$logdir<span style="color:#e6db74">/rsync.log&#34;</span> 2&gt;&amp;1; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    error_exit <span style="color:#e6db74">&#34;备份文件同步失败&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 同步binlog文件</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;开始同步binlog文件&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ! rsync -az <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>datadir<span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span> --include <span style="color:#e6db74">&#39;mysql-bin*&#39;</span> --exclude <span style="color:#e6db74">&#39;*&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>     <span style="color:#e6db74">&#34;rsync@</span><span style="color:#e6db74">${</span>rsync_ip<span style="color:#e6db74">}</span><span style="color:#e6db74">::ftp&#34;</span> --password-file<span style="color:#f92672">=</span>/etc/rsync.password <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>     &gt;&gt; <span style="color:#e6db74">&#34;</span>$logdir<span style="color:#e6db74">/binlog_sync.log&#34;</span> 2&gt;&amp;1; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    error_exit <span style="color:#e6db74">&#34;binlog文件同步失败&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 清理过期备份</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;清理</span><span style="color:#e6db74">${</span>retention_days<span style="color:#e6db74">}</span><span style="color:#e6db74">天前的备份&#34;</span>
</span></span><span style="display:flex;"><span>find <span style="color:#e6db74">&#34;</span>$backupdir<span style="color:#e6db74">&#34;</span> -type f -name <span style="color:#e6db74">&#34;*.gz&#34;</span> -mtime +<span style="color:#e6db74">&#34;</span>$retention_days<span style="color:#e6db74">&#34;</span> -delete
</span></span><span style="display:flex;"><span>find <span style="color:#e6db74">&#34;</span>$backupdir<span style="color:#e6db74">&#34;</span> -type f -name <span style="color:#e6db74">&#34;*.md5&#34;</span> -mtime +<span style="color:#e6db74">&#34;</span>$retention_days<span style="color:#e6db74">&#34;</span> -delete
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 发送成功通知</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;备份任务完成&#34;</span>
</span></span><span style="display:flex;"><span>sendEmail -f wangendao@crv.com.cn -t wangendao@crv.com.cn <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          -s 10.248.2.15 -u <span style="color:#e6db74">&#34;MySQL备份成功通知&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          -o tls<span style="color:#f92672">=</span>no -o message-content-type<span style="color:#f92672">=</span>html <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          -o message-charset<span style="color:#f92672">=</span>utf8 -xu wangendao@crv.com.cn <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          -xp Wed10203040 -m <span style="color:#e6db74">&#34;MySQL备份任务已完成&lt;br&gt;&lt;br&gt;备份数据库列表:&lt;br&gt;</span><span style="color:#e6db74">${</span>DBlist[*]<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;br&gt;&lt;br&gt;备份文件已保留最近</span><span style="color:#e6db74">${</span>retention_days<span style="color:#e6db74">}</span><span style="color:#e6db74">天&#34;</span>
</span></span></code></pre></div></details>
</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-ce9d44ed09004288aefaac879ed320af">xtrabackup</h1>
	<div class="lead">mysql 备份工具之xtrabackup</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-23" class="text-body-secondary">Wednesday, July 23, 2025</time>
        
	</div>
	<h3 id="xtrabackup">xtrabackup</h3>
<p>xtrabackup 与mysql版本矩阵：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">XtraBackup 版本</th>
          <th style="text-align: left">支持的 MySQL 版本</th>
          <th style="text-align: left">关键限制</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>8.0 系列</strong></td>
          <td style="text-align: left">MySQL 8.0.x（推荐 8.0.20+）</td>
          <td style="text-align: left">完全兼容 MySQL 8.0，<strong>不支持 MySQL 5.7 及以下</strong></td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>2.4 系列</strong></td>
          <td style="text-align: left">MySQL 5.6、5.7</td>
          <td style="text-align: left">不支持 MySQL 8.0</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p><strong>注意</strong>：</p>
<ul>
<li>XtraBackup <strong>8.0 不支持备份 MySQL 5.7</strong>。若需备份 MySQL 5.7，必须使用 XtraBackup 2.4。</li>
<li>Percona 强烈建议 <strong>XtraBackup 小版本号与 MySQL 大版本一致</strong>（例如 MySQL 8.0.32 搭配 XtraBackup 8.0.32）。</li>
</ul>
</blockquote>
<h5 id="安装xtrabackup">安装xtrabackup</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat &gt;/etc/yum.repos.d/percona-original-release.repo <span style="color:#e6db74">&lt;&lt;&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[percona-release-x86_64]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name = Percona Original release/x86_64 YUM repository
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl = http://repo.percona.com/percona/yum/release/$releasever/RPMS/x86_64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey = file:///etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[percona-release-noarch]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name = Percona Original release/noarch YUM repository
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl = http://repo.percona.com/percona/yum/release/$releasever/RPMS/noarch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey = file:///etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[percona-release-sources]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name = Percona Original release/sources YUM repository
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl = http://repo.percona.com/percona/yum/release/$releasever/SRPMS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey = file:///etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install -y percona-xtrabackup-80.x86_64 
</span></span></code></pre></div><h5 id="全量备份">全量备份</h5>
<blockquote>
<p>170G 数据压缩后16g,全备耗时7分钟,占用1.5核心cpu</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xtrabackup <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--defaults-file<span style="color:#f92672">=</span>/etc/mysql80/mysql80_6301.cnf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--backup <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;root&#34;</span> --password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--target-dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Backup/fullbackup-</span><span style="color:#66d9ef">$(</span>date +%F<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--compress --compress-threads<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  2&gt;&amp;<span style="color:#ae81ff">1</span> | tee /tmp/mysql6301_<span style="color:#66d9ef">$(</span>date +%F_%H%M%S<span style="color:#66d9ef">)</span>.log
</span></span></code></pre></div><h5 id="恢复全量备份">恢复全量备份</h5>
<blockquote>
<p>限速100Mb 传输16G, 耗时3分钟</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp -l <span style="color:#ae81ff">819200</span> -rp /Backup/fullbackup-2025-07-22/* bak@10.128.99.157:/Data/bak/
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rm -fr /Data/mysql6301/<span style="color:#f92672">{</span>binlog,data,log<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>mkdir  /Data/mysql6301/<span style="color:#f92672">{</span>binlog,data,log<span style="color:#f92672">}</span> -p
</span></span><span style="display:flex;"><span>touch /Data/mysql6301/log/mysqld-error.log
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 解压 16gb 耗时 2分钟</span>
</span></span><span style="display:flex;"><span>xtrabackup --decompress --parallel<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --target-dir<span style="color:#f92672">=</span>/Data/bak --remove-original
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 应用undolog</span>
</span></span><span style="display:flex;"><span>xtrabackup --prepare --apply-log-only --target-dir<span style="color:#f92672">=</span>/Data/bak
</span></span><span style="display:flex;"><span>xtrabackup --prepare --target-dir<span style="color:#f92672">=</span>/Data/bak
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 拷贝全量备份到datadir</span>
</span></span><span style="display:flex;"><span>xtrabackup --defaults-file<span style="color:#f92672">=</span>/etc/my.cnf --copy-back --target-dir<span style="color:#f92672">=</span>/Data/bak
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chown -R mysql.mysql /Data/mysql6301
</span></span><span style="display:flex;"><span>service mysql start 
</span></span><span style="display:flex;"><span>chkconfig mysql on
</span></span></code></pre></div><h5 id="增量同步数据">增量同步数据</h5>


  
  
<ul class="nav nav-tabs" id="tabs-0" role="tablist">
  <li class="nav-item">
      <button class="nav-link active"
          id="tabs-00-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-00" role="tab"
          data-td-tp-persist="主库" aria-controls="tabs-00-00" aria-selected="true">
        主库
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-00-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-01" role="tab"
          data-td-tp-persist="从库" aria-controls="tabs-00-01" aria-selected="false">
        从库
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-0-content">
    <div class="tab-body tab-pane fade show active"
        id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab" tabindex="0">
        <p>创建复制用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;replUser&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;Repl#0001&#39;</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION SLAVE <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;replUser&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>; 
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span> ;
</span></span></code></pre></div>
    </div>
    <div class="tab-body tab-pane fade"
        id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab" tabindex="0">
        <p>设置只读，预防多点写入</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/local/mysql80/bin/mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> --socket<span style="color:#f92672">=</span>/Data/mysql6301/mysql6301.sock --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global read_only<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global super_read_only<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; show variables like <span style="color:#e6db74">&#39;%read_only%&#39;</span>;
</span></span><span style="display:flex;"><span>+-----------------------+-------+
</span></span><span style="display:flex;"><span>| Variable_name         | Value |
</span></span><span style="display:flex;"><span>+-----------------------+-------+
</span></span><span style="display:flex;"><span>| innodb_read_only      | OFF   |
</span></span><span style="display:flex;"><span>| read_only             | ON    |
</span></span><span style="display:flex;"><span>| super_read_only       | ON    |
</span></span><span style="display:flex;"><span>| transaction_read_only | OFF   |
</span></span><span style="display:flex;"><span>+-----------------------+-------+
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> rows in set <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>找到全备时的binlog位置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@db3-mysql80-m data<span style="color:#f92672">]</span><span style="color:#75715e"># cat xtrabackup_binlog_info </span>
</span></span><span style="display:flex;"><span>mysql-bin.000362        <span style="color:#ae81ff">156</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">/*从库*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">reset</span> slave <span style="color:#66d9ef">all</span>;
</span></span><span style="display:flex;"><span>CHANGE MASTER <span style="color:#66d9ef">TO</span> 
</span></span><span style="display:flex;"><span>    MASTER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;10.128.111.157&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span>,
</span></span><span style="display:flex;"><span>    MASTER_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;replUser&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Repl#0001&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mysql-bin.000362&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_LOG_POS<span style="color:#f92672">=</span><span style="color:#ae81ff">156</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">start</span> slave ;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> slave status <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
</span></span></code></pre></div><p>检查slave状态</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@db3-mysql80 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /usr/local/mysql80/bin/mysql -uroot  -p&#39;d988ec6a93!@#MYSQL&#39; --socket=/Data/mysql6301/mysql6301.sock --port=6301 -e &#34;show slave status\G&#34;|grep -E &#34;Slave_IO_Running|Slave_SQL_Running:|Seconds_Behind_Master&#34;</span>
</span></span><span style="display:flex;"><span>mysql: <span style="color:#f92672">[</span>Warning<span style="color:#f92672">]</span> Using a password on the command line interface can be insecure.
</span></span><span style="display:flex;"><span>             Slave_IO_Running: Yes
</span></span><span style="display:flex;"><span>            Slave_SQL_Running: Yes
</span></span><span style="display:flex;"><span>        Seconds_Behind_Master: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div>
    </div>
</div>


</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-4bf71c58d88b7380dd55e728c09e47c2">config</h1>
	<div class="lead">mysql 配置文件解析</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-07-28" class="text-body-secondary">Monday, July 28, 2025</time>
        
	</div>
	<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[mysqld]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">innodb_lock_wait_timeout</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">60</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sort_buffer_size</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">8M</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">query_cache_limit</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">32M</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">auto_increment_offset</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1 </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">auto_increment_increment</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_database</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_results</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_server</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">init_connect</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;启动时自动执行的内容&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#php设置为短连接</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">interactive_timeout</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">30;  #合作的超时时间</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">wait_tiemout</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">30;	#闲置的超时时间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#java 设置长连接</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">interactive_timeout</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">28800;  </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">wait_tiemout</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">28800;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#一个端口最大连接数</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max_connections</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">800</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#一个用户的最大连接数</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#max_user_connections = 800</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#连接错误的最大数量</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max_connect_errors</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">3000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#兼容旧的密码模式</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#old_password = on</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">read_only</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#默认情况下从库启动自动开始同步，添加参数后需要手动start slave ;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">skip_slave_start</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#更新master_info 信息</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sync_master_info</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">记录relaylog，默认开启</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sync_relay_log</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">记录relaylog info </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sync_relay_log_info</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[client]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_client</span> <span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_connection</span> <span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_results</span> <span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[mysql]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span></code></pre></div><p>mysql 乱码字符集设置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">字符集设置</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">names</span> utf8 ;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">等同于</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span><span style="color:#66d9ef">session</span>.character_set_client <span style="color:#f92672">=</span>utf8;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span><span style="color:#66d9ef">session</span>.character_set_connection <span style="color:#f92672">=</span>utf8;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span><span style="color:#66d9ef">session</span>.character_set_results <span style="color:#f92672">=</span>utf8;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span><span style="color:#66d9ef">session</span>.character_set_database <span style="color:#f92672">=</span>utf8;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#f92672">@@</span><span style="color:#66d9ef">session</span>.character_set_server <span style="color:#f92672">=</span>utf8;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[client]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_client</span> <span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_connection</span> <span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_results</span> <span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[mysql]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">character_set_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#导入表时关闭外检检查</span>
</span></span><span style="display:flex;"><span>set foreign_key_check <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查询语句的性能</span>
</span></span><span style="display:flex;"><span>show profing;
</span></span><span style="display:flex;"><span>show profie all;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#设置为分页查询</span>
</span></span><span style="display:flex;"><span>mysql&gt; page less 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; show master logs ;
</span></span><span style="display:flex;"><span>mysql&gt; purge master logs to <span style="color:#e6db74">&#39;binlog文件&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>修复表
</span></span><span style="display:flex;"><span>mysql&gt; repair table 表名
</span></span><span style="display:flex;"><span>myisamchk -r /var/lib/mysql/*.MYI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>查询 innodb 的状态<span style="color:#f92672">(</span>比如死锁<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>show engine innodb status <span style="color:#ae81ff">\G</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>查询运行状态
</span></span><span style="display:flex;"><span>show global status <span style="color:#ae81ff">\G</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>查询增删改的数量
</span></span><span style="display:flex;"><span>mysqladmin -uroot -i <span style="color:#ae81ff">3</span> -r exten|egrep -i <span style="color:#e6db74">&#39;(com_insert\b)|(com_select)|(com_delete\b)|(com_update\b)&#39;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查询进程号</span>
</span></span><span style="display:flex;"><span>pidof mysqld
</span></span><span style="display:flex;"><span>gdb -p <span style="color:#e6db74">`</span>pidof mysqld<span style="color:#e6db74">`</span> -ex <span style="color:#e6db74">&#34;set opt_log_slave_updates=1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IO PS 每秒吞吐量
</span></span><span style="display:flex;"><span>flashcache 开源软件 可以把ssd和sas磁盘虚拟化一块
</span></span><span style="display:flex;"><span>把热数据存在ssd上把sas放在sas上
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>查询 cp io
</span></span><span style="display:flex;"><span>mpstats -P ALL <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100</span>   查询所有cpu的使用情况 每秒打印一个打印100次
</span></span><span style="display:flex;"><span>sar -u <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100</span>          查询所有cpu的使用情况 每秒打印一个打印100次
</span></span><span style="display:flex;"><span>iostat -x <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>sar -b <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>sar -d <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>sar -q
</span></span><span style="display:flex;"><span>sar -n DEV  查看网路
</span></span><span style="display:flex;"><span>sar -W    查看内存
</span></span><span style="display:flex;"><span>sar -r
</span></span><span style="display:flex;"><span>sar -B
</span></span><span style="display:flex;"><span>top 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dmesg -H --level<span style="color:#f92672">=</span>err,warn -k
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>优化
</span></span><span style="display:flex;"><span>numad 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>不使用swap
</span></span><span style="display:flex;"><span>sysctl -a|grep swap 
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;vm.swappiness = 0&#34;</span> &gt;&gt;/etc/sysctl.conf  
</span></span><span style="display:flex;"><span>sysctl -p 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io调度
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /sys/block/sda/queue/scheduler </span>
</span></span><span style="display:flex;"><span>noop <span style="color:#f92672">[</span>deadline<span style="color:#f92672">]</span> cfq
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ulimit 设定
</span></span><span style="display:flex;"><span>软硬文件打开数
</span></span><span style="display:flex;"><span>ulimit -HSn <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#stack size</span>
</span></span><span style="display:flex;"><span>ulimit -s <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>查看raid信息
</span></span><span style="display:flex;"><span>megacil 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># top -b -n 1 | grep Cpu </span>
</span></span><span style="display:flex;"><span>%Cpu<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>:  0.0 us,  6.2 sy,  0.0 ni, 93.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>性能调优
</span></span><span style="display:flex;"><span>https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/6/html/performance_tuning_guide/index
</span></span><span style="display:flex;"><span>https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/performance_tuning_guide/index
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>《mysql反范式》
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>数据类型
</span></span><span style="display:flex;"><span>timestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> current_time<span style="color:#f92672">()</span>,now<span style="color:#f92672">()</span>,sysdate<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>+----------------+---------------------+---------------------+
</span></span><span style="display:flex;"><span>| current_time<span style="color:#f92672">()</span> | now<span style="color:#f92672">()</span>               | sysdate<span style="color:#f92672">()</span>           |
</span></span><span style="display:flex;"><span>+----------------+---------------------+---------------------+
</span></span><span style="display:flex;"><span>| 12:08:14       | 2020-03-08 12:08:14 | 2020-03-08 12:08:14 |
</span></span><span style="display:flex;"><span>+----------------+---------------------+---------------------+
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> row in set <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> inet_aton<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;192.168.0.1&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>+--------------------------+
</span></span><span style="display:flex;"><span>| inet_aton<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;192.168.0.1&#39;</span><span style="color:#f92672">)</span> |
</span></span><span style="display:flex;"><span>+--------------------------+
</span></span><span style="display:flex;"><span>|               <span style="color:#ae81ff">3232235521</span> |
</span></span><span style="display:flex;"><span>+--------------------------+
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> row in set <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> inet_ntoa<span style="color:#f92672">(</span>3232235521<span style="color:#f92672">)</span>;    
</span></span><span style="display:flex;"><span>+-----------------------+
</span></span><span style="display:flex;"><span>| inet_ntoa<span style="color:#f92672">(</span>3232235521<span style="color:#f92672">)</span> |
</span></span><span style="display:flex;"><span>+-----------------------+
</span></span><span style="display:flex;"><span>| 192.168.0.1           |
</span></span><span style="display:flex;"><span>+-----------------------+
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> row in set <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>1.xtrabackup 安装
</span></span><span style="display:flex;"><span>wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.4/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm
</span></span><span style="display:flex;"><span>yum install libev-devel.x86_64
</span></span><span style="display:flex;"><span>yum install numactl-libs.x86_64
</span></span><span style="display:flex;"><span>yum install perl-DBD-MySQL.x86_64
</span></span><span style="display:flex;"><span>rpm -ivh percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm 
</span></span><span style="display:flex;"><span>which xtrabackup
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>备份原理
</span></span><span style="display:flex;"><span>xtrabackup 
</span></span><span style="display:flex;"><span>首先启动备份innodb 引擎的线程 redolog 的备份和监听线程，
</span></span><span style="display:flex;"><span>并开始备份ibd 数据文件。
</span></span><span style="display:flex;"><span>当innodb引擎的数据文件备份完毕后，
</span></span><span style="display:flex;"><span>flust table with read lock;
</span></span><span style="display:flex;"><span>备份 .frm .myd .myi 文件。非innodb引擎数据文件备份完毕后
</span></span><span style="display:flex;"><span>通知redolog 线程结束并记录数据文件的lsn号，便于下次增量
</span></span><span style="display:flex;"><span>备份
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> 性能测试工具
</span></span><span style="display:flex;"><span> mysqlslap
</span></span><span style="display:flex;"><span> 日志分析工具
</span></span><span style="display:flex;"><span>https://www.jb51.net/article/75064.htm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Centos7,centos6适用</span>
</span></span><span style="display:flex;"><span>yum groupinstall <span style="color:#e6db74">&#34;X Window System&#34;</span>
</span></span><span style="display:flex;"><span>yum groupinstall <span style="color:#e6db74">&#34;GNOME Desktop&#34;</span>
</span></span><span style="display:flex;"><span>通过命令 startx 进入图形界面
</span></span><span style="display:flex;"><span>图形到dos：ctrl+alt+f2
</span></span><span style="display:flex;"><span>dos到图形：输入startx
</span></span><span style="display:flex;"><span>或者
</span></span><span style="display:flex;"><span>在命令上输入 init <span style="color:#ae81ff">3</span> 命令 切换到dos界面
</span></span><span style="display:flex;"><span>输入 init 5命令 切换到图形界面
</span></span><span style="display:flex;"><span><span style="color:#75715e">### centos 7</span>
</span></span><span style="display:flex;"><span>systemctl get-default
</span></span><span style="display:flex;"><span>graphical.target代表开机时启动图形化界面
</span></span><span style="display:flex;"><span>multi-user.target代表开机时启动dos界面
</span></span><span style="display:flex;"><span>systemctl set-default graphical.target 
</span></span><span style="display:flex;"><span>systemctl set-default multi-user.target 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ssh 连接客户端长时间不使用自动断开
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span><span style="color:#ae81ff">\$</span>PATH:.
</span></span><span style="display:flex;"><span>export PS1<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\`hostname\`:\$PWD&gt;&#39;</span>
</span></span><span style="display:flex;"><span>set -o vi
</span></span><span style="display:flex;"><span>stty erase ^H
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>back_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>external-locking <span style="color:#f92672">=</span> FALSE
</span></span><span style="display:flex;"><span>max_allowed_packet <span style="color:#f92672">=</span>8M
</span></span><span style="display:flex;"><span>thread_stack <span style="color:#f92672">=</span> 192K
</span></span><span style="display:flex;"><span>thread_stack <span style="color:#f92672">=</span> <span style="color:#ae81ff">192</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysql<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>no-auto-rehash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>过滤
</span></span><span style="display:flex;"><span>change master to Replicate_Ignore_DB <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;test&#39;</span>;
</span></span><span style="display:flex;"><span>Replicate_Do_DB:
</span></span><span style="display:flex;"><span>Replicate_Ignore_DB: 
</span></span><span style="display:flex;"><span>Replicate_Do_Table: 
</span></span><span style="display:flex;"><span>Replicate_Ignore_Table: 
</span></span><span style="display:flex;"><span>Replicate_Wild_Do_Table: 
</span></span><span style="display:flex;"><span>Replicate_Wild_Ignore_Table:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http://itindex.net/index/mha
</span></span><span style="display:flex;"><span>http://mysqlserverteam.com/
</span></span><span style="display:flex;"><span>https://www.cnblogs.com/xiaoboluo768/p/5973827.html
</span></span><span style="display:flex;"><span>https://blog.51cto.com/8370646/2150179
</span></span><span style="display:flex;"><span>https://www.cnblogs.com/zengkefu/p/5600776.html
</span></span><span style="display:flex;"><span>http://www.mamicode.com/info-detail-1488956.html?__cf_chl_jschl_tk__<span style="color:#f92672">=</span>864bd8082fbcc44cff88faa95540ef89c8b1b1ed-1584599149-0-AZzn7zH3F9Q-fMosxg8_z2LhSKfhM8v8fHU4CwyiFxVIk0VzRZI1cOMDw3H6MDQvflAFPsEL9s1MKiUp0hv-9DgUhwYnONrP7mGzp5ZLoSQBlxx9PK4W74ZQrzdsLbUqj3x_clEVUJwdXTPNq-3NiQ0Oz08ONGXWoF2Bx9WfddC9sPngJHUB9CgTE-TKk6o1ktyutexm0QT_zn1jyvml2RK4N133vdGwewmb4QttA_CjOSV4ftDAhu5284B86HQd3Q8VGbn0W9aIC0VGHARUdb5JE0tb2usYTx_IbtaG-QglcJIVYJD5eFWX8Vf7_Okbtw
</span></span></code></pre></div>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-a051ebfaac6fc3a51384fae8d41525a3">mysql数据库搬迁</h1>
	<div class="lead">数据中心搬迁，龙腾出行mysql数据库迁移</div>
	<div class="td-byline mb-4">
		By <b>wangendao</b> |
        
		<time datetime="2025-08-01" class="text-body-secondary">Friday, August 01, 2025</time>
        
	</div>
	<table>
  <thead>
      <tr>
          <th>版本</th>
          <th>旧环境</th>
          <th>新环境</th>
          <th>root密码</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>8.0.22</td>
          <td>192.168.100.157  主库  4C  32GB  350G  + 100GB <br/>192.168.100.158   从库. 4C  32GB  350G  + 0GB</td>
          <td>已部署<br/>10.128.99.157  主库   主库  4C  32GB /Data=  350G  + /Backup = 100GB <br/>10.128.99.158   从库  从库. 4C  32GB /Data= 350G  +  /Backup = null</td>
          <td>d988ec6a93!@#MYSQL</td>
      </tr>
  </tbody>
</table>
<h3 id="全量迁移">全量迁移</h3>
<p>并发请求不高，在主节点执行全量备份</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install -y percona-xtrabackup-80.x86_64 
</span></span></code></pre></div><blockquote>
<p>耗时14分钟</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xtrabackup <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--defaults-file<span style="color:#f92672">=</span>/etc/mysql80/mysql80_6301.cnf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--backup <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;root&#34;</span> --password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--target-dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Backup/fullbackup-</span><span style="color:#66d9ef">$(</span>date +%F<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--compress --compress-threads<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>  2&gt;&amp;<span style="color:#ae81ff">1</span> | tee /tmp/mysql6301_<span style="color:#66d9ef">$(</span>date +%F_%H%M%S<span style="color:#66d9ef">)</span>.log
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 限速50MB</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 10.128.99.157 10.128.99.158</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### service mysql stop</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### rm -fr /Data/bak/* </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### rm -fr /Data/mysql6301/* &amp;&amp;  mkdir /Data/mysql6301/{binlog,data,log} -p ;touch /Data/mysql6301/log/mysqld-error.log </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 10分</span>
</span></span><span style="display:flex;"><span>scp -l <span style="color:#ae81ff">409600</span> -rp /Backup/fullbackup-2025-08-01/* bak@10.128.99.157:/Data/bak/
</span></span><span style="display:flex;"><span>scp -l <span style="color:#ae81ff">409600</span> -rp /Backup/fullbackup-2025-08-01/* bak@10.128.99.158:/Data/bak/
</span></span></code></pre></div><p>全量恢复</p>


<div class="alert alert-warning" role="alert">


    <p>从库备份时会将主从复制关系备份过来, 恢复数据时希望手动指定复制关系，可以通过只读参数取消<strong>slave进程</strong>启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[mysqld]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">skip_slave_start</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">ON</span>
</span></span></code></pre></div>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 解压 16gb 耗时 2分钟</span>
</span></span><span style="display:flex;"><span>xtrabackup --decompress --parallel<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --target-dir<span style="color:#f92672">=</span>/Data/bak --remove-original
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 应用undolog</span>
</span></span><span style="display:flex;"><span>xtrabackup --prepare --apply-log-only --target-dir<span style="color:#f92672">=</span>/Data/bak
</span></span><span style="display:flex;"><span>xtrabackup --prepare --target-dir<span style="color:#f92672">=</span>/Data/bak
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 拷贝全量备份到datadir</span>
</span></span><span style="display:flex;"><span>xtrabackup --defaults-file<span style="color:#f92672">=</span>/etc/my.cnf --copy-back --target-dir<span style="color:#f92672">=</span>/Data/bak
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chown -R mysql.mysql /Data/mysql6301
</span></span><span style="display:flex;"><span>service mysql start 
</span></span><span style="display:flex;"><span>chkconfig mysql on
</span></span></code></pre></div><p>设置只读</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>h <span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">128</span>.<span style="color:#ae81ff">99</span>.<span style="color:#ae81ff">157</span> <span style="color:#75715e">--port=6301 -uroot -p&#39;d988ec6a93!@#MYSQL&#39; -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>; <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;super_read_only&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;read_only&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>h <span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">128</span>.<span style="color:#ae81ff">99</span>.<span style="color:#ae81ff">158</span> <span style="color:#75715e">--port=6301 -uroot -p&#39;d988ec6a93!@#MYSQL&#39; -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>; <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;super_read_only&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;read_only&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><h3 id="增量同步">增量同步</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;replUser&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED  <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;RsU#58d1@&#39;</span> <span style="color:#66d9ef">WITH</span> mysql_native_password ; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION SLAVE,REPLICATION CLIENT <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;replUser&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>; 
</span></span><span style="display:flex;"><span>flush <span style="color:#66d9ef">privileges</span>;
</span></span></code></pre></div><p>查找全备时binlog位置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@db3-mysql80-m ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /Data/bak/xtrabackup_binlog_info </span>
</span></span><span style="display:flex;"><span>mysql-bin.000451       <span style="color:#ae81ff">156</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>h <span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">128</span>.<span style="color:#ae81ff">99</span>.<span style="color:#ae81ff">157</span> <span style="color:#75715e">--port=6301 -uroot -p&#39;d988ec6a93!@#MYSQL&#39; -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">reset</span> slave <span style="color:#66d9ef">all</span>;
</span></span><span style="display:flex;"><span>CHANGE MASTER <span style="color:#66d9ef">TO</span> 
</span></span><span style="display:flex;"><span>    MASTER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;192.168.100.157&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span>,
</span></span><span style="display:flex;"><span>    MASTER_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;replUser&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RsU#58d1@&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mysql-bin.000451&#39;</span>,
</span></span><span style="display:flex;"><span>    MASTER_LOG_POS<span style="color:#f92672">=</span><span style="color:#ae81ff">156</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">start</span> slave ;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> slave status <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -h 10.128.99.158 --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -uroot -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> -e <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">reset slave all;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CHANGE MASTER TO 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MASTER_HOST=&#39;10.128.99.157&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MASTER_PORT=6301,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MASTER_USER=&#39;replUser&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MASTER_PASSWORD=&#39;RsU#58d1@&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MASTER_LOG_FILE=&#39;mysql-bin.000453&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MASTER_LOG_POS=156;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start slave ;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">show slave status \G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h3 id="数据对比">数据对比</h3>
<p>检查主从同步状态</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157 -e &#34;show slave status\G show variables like &#39;%read_only%&#39;&#34;|grep -E &#34;Slave_IO_Running:|Slave_SQL_Running:|Seconds_Behind_Master:|read_only&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.158 -e &#34;show slave status\G show variables like &#39;%read_only%&#39;&#34;|grep -E &#34;Slave_IO_Running:|Slave_SQL_Running:|Seconds_Behind_Master:|read_only&#34;
</span></span></span></code></pre></div><p>统计数据库元数据信息。确保数据库数量、表数量、索引数量、触发器、函数、存储过程、用户数量一致</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.158 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    object_type,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">count</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Users&#39;</span> <span style="color:#66d9ef">AS</span> object_type <span style="color:#66d9ef">FROM</span> mysql.<span style="color:#66d9ef">user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Databases&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.SCHEMATA <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">SCHEMA_NAME</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Tables&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.TABLES <span style="color:#66d9ef">WHERE</span> TABLE_TYPE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;BASE TABLE&#39;</span> <span style="color:#66d9ef">AND</span> TABLE_SCHEMA <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Views&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.VIEWS <span style="color:#66d9ef">WHERE</span> TABLE_SCHEMA <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Triggers&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.TRIGGERS <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">TRIGGER_SCHEMA</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Routines&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.ROUTINES <span style="color:#66d9ef">WHERE</span> ROUTINE_TYPE <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;FUNCTION&#39;</span>, <span style="color:#e6db74">&#39;PROCEDURE&#39;</span>) <span style="color:#66d9ef">AND</span> <span style="color:#66d9ef">ROUTINE_SCHEMA</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Events&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.EVENTS <span style="color:#66d9ef">WHERE</span> EVENT_SCHEMA <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;Indexes&#39;</span> <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">STATISTICS</span> <span style="color:#66d9ef">WHERE</span> TABLE_SCHEMA <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;information_schema&#39;</span>, <span style="color:#e6db74">&#39;performance_schema&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>)
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">AS</span> all_objects
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> object_type <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">ROLLUP</span>;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><h3 id="应用切割">应用切割</h3>
<ol>
<li>
<p>网络层做隔离(网络工程师)</p>
</li>
<li>
<p>旧库设置只读，杀连接 192.168.100.157</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.157  -e &#34;set global read_only=on;set global super_read_only=on;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.157    -e &#34;SELECT CONCAT(&#39;KILL &#39;, id, &#39;;&#39;) FROM information_schema.processlist WHERE user NOT IN (&#39;root&#39;, &#39;replUser&#39;,&#39;event_scheduler&#39;);&#34;  | grep -v CONCAT &gt; /tmp/kill192.168.100.157
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.157  &lt; /tmp/kill192.168.100.157
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.157   -e &#34;show processlist;&#34;
</span></span></span></code></pre></div><p>旧库设置只读，杀连接 192.168.100.158</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.158  -e <span style="color:#e6db74">&#34;set global read_only=on;set global super_read_only=on;show variables like &#39;%read_only%&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.158    -e <span style="color:#e6db74">&#34;SELECT CONCAT(&#39;KILL &#39;, id, &#39;;&#39;) FROM information_schema.processlist WHERE user NOT IN (&#39;root&#39;, &#39;replUser&#39;,&#39;event_scheduler&#39;);&#34;</span>  | grep -v CONCAT &gt; /tmp/kill192.168.100.158
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.158  &lt; /tmp/kill192.168.100.158
</span></span><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.158   -e <span style="color:#e6db74">&#34;show processlist;&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>停旧库和新库之间的数据同步</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 10.128.99.157  -e <span style="color:#e6db74">&#34;show slave status\G&#34;</span> &gt;/tmp/last_slave_state
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sleep 5;
</span></span><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 10.128.99.157  -e <span style="color:#e6db74">&#34;stop slave;reset slave all;show slave status\G&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>记录当前binglog位置用于回滚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157 -e &#34;show master status;&#34; &gt;/tmp/binlog_rollback_info
</span></span></span></code></pre></div></li>
<li>
<p>创建双主关系 10.128.99.157 &ndash;&gt; 10.128.99.158</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">多次执行确认master 位置不在变化</h4>

    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.158 -e &#34;show master status;&#34; |tee /tmp/master1012899158
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>cat <span style="color:#f92672">/</span>tmp<span style="color:#f92672">/</span>master1012899158
</span></span></code></pre></div>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CHANGE MASTER <span style="color:#66d9ef">TO</span>
</span></span><span style="display:flex;"><span>MASTER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;10.128.99.158&#39;</span>,
</span></span><span style="display:flex;"><span>MASTER_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span>,
</span></span><span style="display:flex;"><span>MASTER_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;replUser&#39;</span>,
</span></span><span style="display:flex;"><span>MASTER_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RsU#58d1@&#39;</span>,
</span></span><span style="display:flex;"><span>MASTER_LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>MASTER_LOG_POS<span style="color:#f92672">=</span>;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><p>启动主从关系</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 10.128.99.157 -e <span style="color:#e6db74">&#34;start slave ; show slave status \G&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>新库关闭只读</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%read_only%&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.158 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%read_only%&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div></li>
<li>
<p>观察连接情况</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.158  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.157  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.158  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span></code></pre></div></li>
</ol>
<h3 id="回退环境搭建">回退环境搭建</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> <span style="color:#75715e">--port=6301 -h 192.168.100.157 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>stop slave; <span style="color:#66d9ef">reset</span> slave <span style="color:#66d9ef">all</span>; <span style="color:#66d9ef">show</span> slave status <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /tmp/binlog_rollback_info
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.157 -e <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;CHANGE MASTER TO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_HOST=&#39;10.128.99.157&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=6301,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;replUser&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;RsU#58d1@&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_FILE=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_POS=;&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.157 -e <span style="color:#e6db74">&#34;start slave;show slave status\G&#34;</span>
</span></span></code></pre></div><h3 id="执行回退">执行回退</h3>
<ol>
<li>
<p>旧库设置只读，杀连接</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157 -e &#34;set global read_only=on;set global super_read_only=on;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157  -e &#34;SELECT CONCAT(&#39;KILL &#39;, id, &#39;;&#39;) FROM information_schema.processlist WHERE user NOT IN (&#39;root&#39;, &#39;replUser&#39;,&#39;event_scheduler&#39;);&#34;  | grep -v CONCAT &gt; /tmp/kill10.128.99.157 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157   &lt; /tmp/kill10.128.99.157 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157    -e &#34;show processlist;&#34;
</span></span></span></code></pre></div></li>
<li>
<p>停旧库和新库之间的数据同步</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">没有延迟后，重置主从同步，取消只读。</span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> <span style="color:#75715e">--port=6301 -h 192.168.100.157 -e &#34;stop slave;reset slave all;&#34;
</span></span></span></code></pre></div><p>恢复 192.168.100.157 &ndash;&gt; 192.168.100.158 的数据同步</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">多次执行确认master 位置不在变化</h4>

    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> <span style="color:#75715e">--port=6301 -h 192.168.100.158 -e &#34;show master status;&#34; |tee /tmp/master192168100158
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>cat <span style="color:#f92672">/</span>tmp<span style="color:#f92672">/</span>master192168100158
</span></span></code></pre></div>

</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysql -uroot  -p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> --port<span style="color:#f92672">=</span><span style="color:#ae81ff">6301</span> -h 192.168.100.157 -e <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CHANGE MASTER TO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_HOST=&#39;192.168.100.158&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=6301,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;replUser&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;RsU#58d1@&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_FILE=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_POS=;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> <span style="color:#75715e">--port=6301 -h 192.168.100.157 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">start</span> slave ;<span style="color:#66d9ef">show</span> slave status <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> <span style="color:#75715e">--port=6301 -h 192.168.100.157 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;<span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span> <span style="color:#75715e">--port=6301 -h 192.168.100.158 -e &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> super_read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">off</span>;<span style="color:#e6db74">&#34;
</span></span></span></code></pre></div></li>
<li>
<p>查看连接状态</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.157  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 10.128.99.158  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.157  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot  <span style="color:#f92672">-</span>p<span style="color:#e6db74">&#39;d988ec6a93!@#MYSQL&#39;</span>  <span style="color:#75715e">--port=6301 -h 192.168.100.158  -e &#34;show processlist;show variables like &#39;%read_only%&#39;;&#34;
</span></span></span></code></pre></div></li>
</ol>

</div>





    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="联系我" aria-label="联系我">
    <a target="_blank" rel="noopener" href="/about/#%e8%81%94%e7%b3%bb%e6%96%b9%e5%bc%8f" aria-label="联系我">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="微信" aria-label="微信">
    <a target="_blank" rel="noopener" href="/about/#%e8%81%94%e7%b3%bb%e6%96%b9%e5%bc%8f" aria-label="微信">
      <i class="fa-brands fa-weixin"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">零露云©2025版权所有</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.bf0cab613e991fc11bc28a4a07b0aedef47c7c7c2595703ac3adf962fd6a8099.js" integrity="sha256-vwyrYT6ZH8EbwopKB7Cu3vR8fHwllXA6w635Yv1qgJk=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
