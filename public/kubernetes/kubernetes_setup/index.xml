<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>环境搭建 on 零露云</title>
    <link>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/</link>
    <description>Recent content in 环境搭建 on 零露云</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <copyright>零露云©2025版权所有</copyright>
    <lastBuildDate>Tue, 15 Jul 2025 15:22:40 +0800</lastBuildDate>
    <atom:link href="https://zero-dew.netlify.app/kubernetes/kubernetes_setup/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>kubeadm环境搭建</title>
      <link>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/quitstart.html</link>
      <pubDate>Wed, 21 May 2025 15:22:40 +0800</pubDate>
      <guid>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/quitstart.html</guid>
      <description>&lt;div class=&#34;alert alert-primary&#34; role=&#34;alert&#34;&gt;&#xA;&#xA;&#xA;    &lt;p&gt;阅读该文档你将了解到：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 从0到1搭建kubernetes环境&lt;/li&gt;&#xA;&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 基于kubernetes的可观测平台构建&lt;/li&gt;&#xA;&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; CI/CD  环境与k8s的集成&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;本示例完全实现下图架构,并试图对 &lt;code&gt;cni/可观测性/cicd&lt;/code&gt; 能力进行扩展。力图构建一套生产环境可用的模型。&lt;/p&gt;&#xA;&#xA;&#xA;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;​&lt;/p&gt;&#xA;&#xA;  &#xA;  &#xA;&lt;ul class=&#34;nav nav-tabs&#34; id=&#34;tabs-1&#34; role=&#34;tablist&#34;&gt;&#xA;  &lt;li class=&#34;nav-item&#34;&gt;&#xA;      &lt;button class=&#34;nav-link active&#34;&#xA;          id=&#34;tabs-01-00-tab&#34; data-bs-toggle=&#34;tab&#34; data-bs-target=&#34;#tabs-01-00&#34; role=&#34;tab&#34;&#xA;          data-td-tp-persist=&#34;架构&#34; aria-controls=&#34;tabs-01-00&#34; aria-selected=&#34;true&#34;&gt;&#xA;        架构&#xA;      &lt;/button&gt;&#xA;    &lt;/li&gt;&lt;li class=&#34;nav-item&#34;&gt;&#xA;      &lt;button class=&#34;nav-link&#34;&#xA;          id=&#34;tabs-01-01-tab&#34; data-bs-toggle=&#34;tab&#34; data-bs-target=&#34;#tabs-01-01&#34; role=&#34;tab&#34;&#xA;          data-td-tp-persist=&#34;服务器列表&#34; aria-controls=&#34;tabs-01-01&#34; aria-selected=&#34;false&#34;&gt;&#xA;        服务器列表&#xA;      &lt;/button&gt;&#xA;    &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;div class=&#34;tab-content&#34; id=&#34;tabs-1-content&#34;&gt;&#xA;    &lt;div class=&#34;tab-body tab-pane fade show active&#34;&#xA;        id=&#34;tabs-01-00&#34; role=&#34;tabpanel&#34; aria-labelled-by=&#34;tabs-01-00-tab&#34; tabindex=&#34;1&#34;&gt;&#xA;        &lt;img src=&#34;https://kubernetes.io/zh-cn/docs/images/kubeadm-ha-topology-stacked-etcd.svg&#34;&gt;&#xA;&#xA;    &lt;/div&gt;&#xA;    &lt;div class=&#34;tab-body tab-pane fade&#34;&#xA;        id=&#34;tabs-01-01&#34; role=&#34;tabpanel&#34; aria-labelled-by=&#34;tabs-01-01-tab&#34; tabindex=&#34;1&#34;&gt;&#xA;        &lt;p&gt;&lt;em&gt;通过自建dns 或 &lt;code&gt;/etc/hosts&lt;/code&gt; 文件实现对所有主机间的主机名解析&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;独立挂载&lt;code&gt;/var/lib/docker&lt;/code&gt; 、&lt;code&gt;/var/lib/kubelet&lt;/code&gt; 、&lt;code&gt;etcd&lt;/code&gt;数据目录&lt;/em&gt;&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;hostname&lt;/th&gt;&#xA;          &lt;th&gt;os&lt;/th&gt;&#xA;          &lt;th&gt;ipaddress&lt;/th&gt;&#xA;          &lt;th&gt;roles&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;master01&lt;/td&gt;&#xA;          &lt;td&gt;centos7.9&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.108/24&lt;/td&gt;&#xA;          &lt;td&gt;master、node、keepalived、nginx、nfs&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;master02&lt;/td&gt;&#xA;          &lt;td&gt;centos7.9&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.140/24&lt;/td&gt;&#xA;          &lt;td&gt;master、node、keepalived、nginx&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;master03&lt;/td&gt;&#xA;          &lt;td&gt;centos7.9&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.162/24&lt;/td&gt;&#xA;          &lt;td&gt;master、node、keepalived、nginx&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;node01&lt;/td&gt;&#xA;          &lt;td&gt;centos7.9&lt;/td&gt;&#xA;          &lt;td&gt;&lt;/td&gt;&#xA;          &lt;td&gt;node&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;node02&lt;/td&gt;&#xA;          &lt;td&gt;centos7.9&lt;/td&gt;&#xA;          &lt;td&gt;&lt;/td&gt;&#xA;          &lt;td&gt;node&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;virtualhost&lt;/td&gt;&#xA;          &lt;td&gt;&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.144/24&lt;/td&gt;&#xA;          &lt;td&gt;vip&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;    &lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;  &#xA;&lt;ul class=&#34;nav nav-tabs&#34; id=&#34;tabs-2&#34; role=&#34;tablist&#34;&gt;&#xA;  &lt;li class=&#34;nav-item&#34;&gt;&#xA;      &lt;button class=&#34;nav-link disabled&#34;&#xA;          id=&#34;tabs-02-00-tab&#34; data-bs-toggle=&#34;tab&#34; data-bs-target=&#34;#tabs-02-00&#34; role=&#34;tab&#34;&#xA;          aria-controls=&#34;tabs-02-00&#34; aria-selected=&#34;false&#34;&gt;&#xA;        &lt;strong&gt;系统优化&lt;/strong&gt;:&#xA;      &lt;/button&gt;&#xA;    &lt;/li&gt;&lt;li class=&#34;nav-item&#34;&gt;&#xA;      &lt;button class=&#34;nav-link active&#34;&#xA;          id=&#34;tabs-02-01-tab&#34; data-bs-toggle=&#34;tab&#34; data-bs-target=&#34;#tabs-02-01&#34; role=&#34;tab&#34;&#xA;          data-td-tp-persist=&#34;系统初始化&#34; aria-controls=&#34;tabs-02-01&#34; aria-selected=&#34;true&#34;&gt;&#xA;        系统初始化&#xA;      &lt;/button&gt;&#xA;    &lt;/li&gt;&lt;li class=&#34;nav-item&#34;&gt;&#xA;      &lt;button class=&#34;nav-link&#34;&#xA;          id=&#34;tabs-02-02-tab&#34; data-bs-toggle=&#34;tab&#34; data-bs-target=&#34;#tabs-02-02&#34; role=&#34;tab&#34;&#xA;          data-td-tp-persist=&#34;lb&#34; aria-controls=&#34;tabs-02-02&#34; aria-selected=&#34;false&#34;&gt;&#xA;        LB&#xA;      &lt;/button&gt;&#xA;    &lt;/li&gt;&lt;li class=&#34;nav-item&#34;&gt;&#xA;      &lt;button class=&#34;nav-link&#34;&#xA;          id=&#34;tabs-02-03-tab&#34; data-bs-toggle=&#34;tab&#34; data-bs-target=&#34;#tabs-02-03&#34; role=&#34;tab&#34;&#xA;          data-td-tp-persist=&#34;keepalived&#34; aria-controls=&#34;tabs-02-03&#34; aria-selected=&#34;false&#34;&gt;&#xA;        keepalived&#xA;      &lt;/button&gt;&#xA;    &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;div class=&#34;tab-content&#34; id=&#34;tabs-2-content&#34;&gt;&#xA;    &lt;div class=&#34;tab-body tab-pane fade&#34;&#xA;        id=&#34;tabs-02-00&#34; role=&#34;tabpanel&#34; aria-labelled-by=&#34;tabs-02-00-tab&#34; tabindex=&#34;2&#34;&gt;&#xA;        &#xA;    &lt;/div&gt;&#xA;    &lt;div class=&#34;tab-body tab-pane fade show active&#34;&#xA;        id=&#34;tabs-02-01&#34; role=&#34;tabpanel&#34; aria-labelled-by=&#34;tabs-02-01-tab&#34; tabindex=&#34;2&#34;&gt;&#xA;        &lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#!/bin/bash&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# author: 1209233066@qq.com&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# description:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#&#x9;init linux env for kuernetes v24-&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   function:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           1. sethostname &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           2. turn off swap&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           3. turn off selinux&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           4. turn off firewalld&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           5. turn on kernel for netfilter/ip_nonlocal_bind&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           6. turn on ipvs modle&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           7. modify cgroup driver for docker&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           8. allow bind nonlocal ip&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#           &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LC_ALL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;C&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;SetEnv&lt;span style=&#34;color:#f92672&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;&lt;span style=&#34;color:#75715e&#34;&gt;# 设置主机名和时区&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;hostnamectl set-hostname &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;$1&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;timedatectl set-timezone Asia/Shanghai&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;&lt;span style=&#34;color:#75715e&#34;&gt;# 关闭swap分区 &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    swapoff -a &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/swap/s|^|#|g&amp;#39;&lt;/span&gt; /etc/fstab&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 关闭selinux &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    setenforce &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s|SELINUX=enforcing|SELINUX=disabled|g&amp;#39;&lt;/span&gt; /etc/selinux/config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 关闭firewalld&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    systemctl disable --now firewalld&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 加载 br_netfilter 模块&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    echo br_netfilter &amp;gt;/etc/modules-load.d/br_netfilter.conf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 加载ipvs 模块&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ls /usr/lib/modules/&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;uname -r&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;/kernel/net/netfilter/ipvs |awk -F &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; &amp;gt;/etc/modules-load.d/ipvs.conf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 加载/etc/modules-load.d 下配置文件&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    systemctl restart systemd-modules-load&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 开启 bridge-nf-call-iptables内核功能&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 开启 bridge-nf-call-ip6tables 内核功能&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 开启数据包内核转发功能&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sysctl -w net.bridge.bridge-nf-call-iptables&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sysctl -w net.bridge.bridge-nf-call-ip6tables&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sysctl -w net.ipv4.ip_forward&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sysctl -w net.ipv4.ip_nonlocal_bind&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;echo -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward = 1\nnet.ipv4.ip_nonlocal_bind = 1&amp;#34;&lt;/span&gt; &amp;gt;/etc/sysctl.d/kubernetes.conf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;&lt;span style=&#34;color:#75715e&#34;&gt;# &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;yum install ipvsadm -y&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;&lt;span style=&#34;color:#75715e&#34;&gt;#&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;curl https://get.docker.com|bash -s -- --mirror Aliyun --version 20.10.24 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;&#x9;mkdir /etc/docker &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;&#x9;echo -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{\n\t&amp;#34;exec-opts&amp;#34;: [&amp;#34;native.cgroupdriver=systemd&amp;#34;]\n}&amp;#39;&lt;/span&gt; &amp;gt;/etc/docker/daemon.json&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;systemctl daemon-reload&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;systemctl enable docker --now&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#x9;systemctl status docker&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;SetEnv&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;    &lt;/div&gt;&#xA;    &lt;div class=&#34;tab-body tab-pane fade&#34;&#xA;        id=&#34;tabs-02-02&#34; role=&#34;tabpanel&#34; aria-labelled-by=&#34;tabs-02-02-tab&#34; tabindex=&#34;2&#34;&gt;&#xA;        &lt;div class=&#34;alert alert-primary&#34; role=&#34;alert&#34;&gt;&#xA;&lt;h4 class=&#34;alert-heading&#34;&gt;L4负载均衡，在所有master节点执行&lt;/h4&gt;&#xA;&lt;pre&gt;&lt;code&gt;sysctl -w net.ipv4.ip_nonlocal_bind=1&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;user  nginx;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;worker_processes  1;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;events &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    worker_connections  1024;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;stream &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        log_format main &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;$remote_addr [$time_local] &amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;$protocol $status $bytes_sent $bytes_received &amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;$session_time &amp;#34;$upstream_addr&amp;#34; &amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#34;$upstream_bytes_sent&amp;#34; &amp;#34;$upstream_bytes_received&amp;#34; &amp;#34;$upstream_connect_time&amp;#34;&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        upstream kube_apiserver &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                server 192.168.0.108:6443 weight&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; max_fails&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; fail_timeout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;30s;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                server 192.168.0.140:6443 weight&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; max_fails&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; fail_timeout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;30s;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                server 192.168.0.162:6443 weight&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; max_fails&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; fail_timeout&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;30s;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                listen 192.168.0.144:16443;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                proxy_connect_timeout 2s;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                proxy_timeout 900s;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                proxy_pass kube_apiserver;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                access_log  logs/kubeapiserver.log main;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;    &lt;/div&gt;&#xA;    &lt;div class=&#34;tab-body tab-pane fade&#34;&#xA;        id=&#34;tabs-02-03&#34; role=&#34;tabpanel&#34; aria-labelled-by=&#34;tabs-02-03-tab&#34; tabindex=&#34;2&#34;&gt;&#xA;        &lt;p&gt;三个节点使用相同的&lt;code&gt; BACKUP&lt;/code&gt; 和 &lt;code&gt;priority 100&lt;/code&gt; 初始化时拥有对等角色,vrrp初次选举时如果&lt;code&gt;priority &lt;/code&gt; 相同则会选择ip较大的节点拥有vip，因此不用担心相同&lt;code&gt;priority&lt;/code&gt; 脑裂问题。&#xA;而&lt;code&gt;state BACKUP&lt;/code&gt; 是为了让非抢占参数&lt;code&gt;nopreempt&lt;/code&gt; 能够生效&lt;/p&gt;</description>
    </item>
    <item>
      <title>kubeaz环境搭建</title>
      <link>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/kubeaz.html</link>
      <pubDate>Wed, 21 May 2025 15:22:40 +0800</pubDate>
      <guid>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/kubeaz.html</guid>
      <description>&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone  https://github.com/easzlab/kubeasz.git&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;环境&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;主机&lt;/th&gt;&#xA;          &lt;th&gt;ip&lt;/th&gt;&#xA;          &lt;th&gt;资源&lt;/th&gt;&#xA;          &lt;th&gt;kernel&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;master01&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.243&lt;/td&gt;&#xA;          &lt;td&gt;2c 4g 100GB&lt;/td&gt;&#xA;          &lt;td&gt;centos7 3.10&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;master02&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.244&lt;/td&gt;&#xA;          &lt;td&gt;2c 4g 100GB&lt;/td&gt;&#xA;          &lt;td&gt;centos7 3.10&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;master03&lt;/td&gt;&#xA;          &lt;td&gt;192.168.0.245&lt;/td&gt;&#xA;          &lt;td&gt;2c 4g 100GB&lt;/td&gt;&#xA;          &lt;td&gt;centos7 3.10&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;时间同步&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;chrony&lt;/code&gt; 是一个优秀的 &lt;code&gt;NTP&lt;/code&gt; 实现，性能比ntp好，且配置管理方便；它既可作时间服务器服务端，也可作客户端。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;安装chronyd服务&lt;/strong&gt;:&#x9;&lt;code&gt; yum install chrony&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;配置时间服务器地址&lt;/strong&gt;:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# server &amp;lt;时间服务器&amp;gt;  &amp;lt;客户端向服务端发起时间同步的最小间隔，示例中4 表示 2^4=64s&amp;gt; &amp;lt;客户端向服务端发起时间同步的最大间隔，示例中10表示 2^10=1024s&amp;gt; &#xD;&#xA;server ntp.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server ntp1.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server ntp2.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server ntp3.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server ntp4.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server ntp5.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server ntp6.aliyun.com minpoll 4 maxpoll 10 iburst&#xD;&#xA;server 192.168.0.251 minpoll 4 maxpoll 10 iburst&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;作为服务端时，允许连接的客户端&lt;/strong&gt;:&lt;/p&gt;</description>
    </item>
    <item>
      <title>kubeadm工具</title>
      <link>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/kubeadm.html</link>
      <pubDate>Tue, 15 Jul 2025 15:22:40 +0800</pubDate>
      <guid>https://zero-dew.netlify.app/kubernetes/kubernetes_setup/kubeadm.html</guid>
      <description>&lt;hr&gt;&#xA;&lt;p&gt;&lt;strong&gt;任务：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 什么是bootstraptoken,在kubernetes中的应用&lt;/li&gt;&#xA;&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; kube-apiserver 的认证方式有哪些，输出最佳实践&lt;/li&gt;&#xA;&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; kubeadm 配置文件结构体，支持哪些配置和字段&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;authentication  认证&lt;/p&gt;&#xA;&lt;p&gt;authorization   授权&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;执行kubeadm init 阶段将&lt;code&gt;ClusterConfiguration&lt;/code&gt; 配置上传到kube-system名称空间下&lt;code&gt;kubeadm-config&lt;/code&gt; configmap中，&lt;/p&gt;&#xA;&lt;p&gt;执行&lt;code&gt;kubeadm join&lt;/code&gt;、&lt;code&gt;kubeadm reset&lt;/code&gt;、 &lt;code&gt;kubeadm upgrade&lt;/code&gt; 时读取该配置&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;kubeadm config migrate&lt;/code&gt; 来转换旧配置文件&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;kubeadm config validate&lt;/code&gt; 可用于验证配置文件&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;kubeadm config images list&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;kubeadm config images pull&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;kubeadm config print&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;kubeadm token create&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;配置文件包含5中类型：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apiVersion: kubeadm.k8s.io/v1beta3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kind: InitConfiguration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apiVersion: kubeadm.k8s.io/v1beta3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kind: ClusterConfiguration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apiVersion: kubelet.config.k8s.io/v1beta1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kind: KubeletConfiguration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apiVersion: kubeproxy.config.k8s.io/v1alpha1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kind: KubeProxyConfiguration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apiVersion: kubeadm.k8s.io/v1beta3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kind: JoinConfiguration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm config print init-defaults&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm config print join-defaults&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm config print init-defaults &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--component-configs KubeProxyConfiguration &lt;span style=&#34;color:#ae81ff&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--component-configs KubeletConfiguration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;kubeadm/app/apis/kubeadm/types.go&lt;/code&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
